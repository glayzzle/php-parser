// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bind_empty.phpt
  it("binding empty values", function () {
    expect(parser.parseCode("<?php\nrequire __DIR__.'/connect.inc';\n$drop = \"DROP table bind_empty_tab\";\n$statement = oci_parse($c, $drop);\n@oci_execute($statement);\n$create = \"CREATE table bind_empty_tab(name VARCHAR(10))\";\n$statement = oci_parse($c, $create);\noci_execute($statement);\necho \"Test 1\\n\";\n$name = null;\n$stmt = oci_parse($c, \"UPDATE bind_empty_tab SET name=:name\");\noci_bind_by_name($stmt, \":name\", $name);\nvar_dump(oci_execute($stmt));\necho \"Test 2\\n\";\n$name = \"\";\n$stmt = oci_parse($c, \"UPDATE bind_empty_tab SET name=:name\");\noci_bind_by_name($stmt, \":name\", $name);\nvar_dump(oci_execute($stmt));\necho \"Test 3\\n\";\n$stmt = oci_parse($c, \"INSERT INTO bind_empty_tab (NAME) VALUES ('abc')\");\n$res = oci_execute($stmt);\n$stmt = oci_parse($c, \"INSERT INTO bind_empty_tab (NAME) VALUES ('def')\");\n$res = oci_execute($stmt);\n$name = null;\n$stmt = oci_parse($c, \"UPDATE bind_empty_tab SET name=:name WHERE NAME = 'abc'\");\noci_bind_by_name($stmt, \":name\", $name);\nvar_dump(oci_execute($stmt));\n$stid = oci_parse($c, \"select * from bind_empty_tab order by 1\");\noci_execute($stid);\noci_fetch_all($stid, $res);\nvar_dump($res);\necho \"Test 4\\n\";\n$name = \"\";\n$stmt = oci_parse($c, \"UPDATE bind_empty_tab SET name=:name WHERE NAME = 'def'\");\noci_bind_by_name($stmt, \":name\", $name);\nvar_dump(oci_execute($stmt));\n$stid = oci_parse($c, \"select * from bind_empty_tab order by 1\");\noci_execute($stid);\noci_fetch_all($stid, $res);\nvar_dump($res);\necho \"Test 5\\n\";\n$av = $bv = 'old';\n$s = oci_parse($c, \"begin :bv := null; end; \");\noci_bind_by_name($s, \":bv\", $bv);\noci_execute($s);\nvar_dump($av);\nvar_dump($bv);\necho \"Test 6\\n\";\n$av = $bv = null;\n$s = oci_parse($c, \"begin :bv := null; end; \");\noci_bind_by_name($s, \":bv\", $bv);\noci_execute($s);\nvar_dump($av);\nvar_dump($bv);\n// Clean up\n$drop = \"DROP table bind_empty_tab\";\n$statement = oci_parse($c, $drop);\n@oci_execute($statement);\n?>")).toMatchSnapshot();
  });
});
