// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/array/bug34066_1.phpt
  it("Bug #34066 (recursive array_walk causes segfault)", function () {
    expect(parser.parseCode("<?php\n    $order = array(\n        \"DocID\"\t\t\t=>\t\"1\",\n        \"DocDate\"\t\t=>\t\"19.09.06\",\n        \"ReSubmissionDate\"\t=>\t\"\",\n        \"DocTyp\"\t\t=>\t\"Stapelauftrag\",\n        \"CustID\"\t\t=>\t\"00000\",\n        \"CustomerAddress\" => array(\n            array(\n                \"Name1\"\t\t=>\t'name1',\n                \"Name2\"\t\t=>\t'name2',\n                \"Name3\"\t\t=>\t\"\",\n                \"City\"\t\t=>\t'city',\n                \"Street\"\t=>\t'street',\n                \"Postal\"\t=>\t'postcode',\n                \"IATA\"\t\t=>\t\"90\",\n                \"Country\"\t=>\t\"Deutschland\",\n                \"ShortName\"\t=>\t'short',\n                \"ContactKey\"\t=>\t\"\",\n                \"EMail\"\t\t=>\t'email@example.com',\n            )\n        ),\n        \"Text1\"\t\t\t=>\t\"\",\n        \"Text2\"\t\t\t=>\t\"\",\n        \"Wildcard1\"\t\t=>\t\"\",\n        \"Wildcard2\"\t\t=>\t\"\",\n        \"Dispatch\"\t\t=>\t\"Paketdienst\",\n        \"Weight\"\t\t=>\t\"0,0\",\n        \"BillingCustID\"\t\t=>\t\"4300200000\",\n        \"ExtDocNr\"\t\t=>\t\"00000000003\",\n        \"AnalysisLock\"\t\t=>\t\"\",\n        \"PrintFlag\"\t\t=>\t\"\",\n        \"FormType\"\t\t=>\t\"0\",\n        \"Curr\"\t\t\t=>\t\"EUR\",\n        \"ExChangeRate\"\t\t=>\t\"1,0000\",\n        \"WIRRate\"\t\t=>\t\"0\",\n        \"OneTimeCustomer\" => array(\n            array(\n                \"BankCode\"\t=>\t\"\",\n                \"BankAccount\"\t=>\t\"\"\n            )\n        ),\n        \"Language\"\t\t=>\t\"0\",\n        \"PriceGroup\"\t\t=>\t\"1\",\n        \"PrFlag\"\t\t=>\t\"0\",\n        \"SalesTaxKey\"\t\t=>\t\"1\",\n        \"ProceedKey\"\t\t=>\t\"0\",\n        \"CustDiscountGroup\"\t=>\t\"0\",\n        \"Discount\" => array(\n            array(\n                \"FinDisc1\"\t=>\t\"0,00\",\n                \"Disc1Base\"\t=>\t\"145,72\",\n                \"Disc1Value\"\t=>\t\"0,00\",\n                \"FinDisc2\"\t=>\t\"0,00\",\n                \"Disc2Base\"\t=>\t\"145,72\",\n                \"Disc2Value\"\t=>\t\"0,00\",\n                \"FinDisc3\"\t=>\t\"0,00\",\n                \"Disc3Base\"\t=>\t\"145,72\",\n                \"Disc3Value\"\t=>\t\"0,00\",\n                \"ValueSummary\"\t=>\t\"0,00\"\n            )\n        ),\n        \"Contact\" => array(\n            array(\n                \"Repr\"\t\t=>\t\"999\",\n                \"Region\"\t=>\t\"99\",\n                \"Commission\"\t=>\t\"0,00\",\n                \"Agent\"\t\t=>\t\"000000\"\n            )\n        ),\n        \"Booking\" => array(\n            array(\n                \"CostUnit\"\t=>\t\"0000000000\",\n                \"CostCentre\"\t=>\t\"0000000000\",\n                \"AccountingArea\"=>\t\"01\"\n            )\n        ),\n        \"InvoiceCycleKey\"\t=>\t\"0\",\n        \"AnalysisKey\"\t\t=>\t\"\",\n        \"OrderNumber\"\t\t=>\t\"\",\n        \"OrderDate\"\t\t=>\t\"\",\n        \"OrderCode\"\t\t=>\t\"\",\n        \"DocItems\" => array(\n            \"DocItem\" => array(\n                \"PosType\"\t\t=>\t\"1\",\n                \"ItemRef\"\t\t=>\t\"1002\",\n                \"CRef\"\t\t\t=>\t\"\",\n                \"Desc1\"\t\t\t=>\t\"Prï¿½sentation Niederlande per\",\n                \"Desc2\"\t\t\t=>\t\"\",\n                \"ArticleGroup\"\t\t=>\t\"102\",\n                \"PosTypeVersion\"\t=>\t\"E\",\n                \"Delivery\" => array(\n                    array(\n                        \"DelWeek\"\t=>\t\"\",\n                        \"DelDay\"\t=>\t\"\",\n                        \"DelTime\"\t=>\t\"\"\n                    )\n                ),\n        \"PricePu\"\t\t=>\t\"145,72\",\n        \"PriceUnit\"\t\t=>\t\"0\",\n        \"PriceCalculation\"\t=>\t\"0\",\n        \"ItemVal\"\t\t=>\t\"145,72\",\n        \"InputKey\"\t\t=>\t\"0\",\n        \"AveragePurchasePrice\"\t=>\t\"0\",\n                \"Tax\" => array(\n                    array(\n                        \"TaxCode\"\t=>\t\"00\",\n                        \"TaxBra\"\t=>\t\"000\",\n                        \"TaxBraAccess\"\t=>\t\"0\",\n                        \"TaxSumIndex\"\t=>\t\"0\"\n                    )\n                ),\n                \"DiscountArticle\" => array(\n                    array(\n                        \"DiscPC\"\t=>\t\"0,00\",\n                        \"DiscKey\"\t=>\t\"1\"\n                    )\n                ),\n                \"ProceedKeyArticle\"\t=>\t\"01\",\n                \"ActionKey\"\t\t=>\t\"00\",\n                \"ContactCommissionArticle\"=>\t\"0,00\",\n                \"QuantdependentPriceKey\"=>\t\"\",\n                \"Quant\"\t\t\t=>\t\"1\",\n                \"QuantUnit\"\t\t=>\t\"\",\n                \"Meas\" => array(\n                    array(\n                        \"Count\"\t\t=>\t\"1\",\n                        \"Length\"\t=>\t\"0,000\",\n                        \"Width\"\t\t=>\t\"0,000\",\n                        \"Height\"\t=>\t\"0,000\"\n                    )\n                ),\n                \"DecimalPlace\"\t\t=>\t\"0\",\n                \"MultiplierQuant\"\t=>\t\"1,000000\",\n                \"DifferingQuantUnit\"\t=>\t\"\",\n                \"DecimalPlaceConversion\"=>\t\"0\",\n                \"WeightArticle\" => array(\n                    array(\n                        \"Amount\"\t=>\t\"0\",\n                        \"Unit\"\t\t=>\t\"0\"\n                    )\n                ),\n                \"Wreath\"\t\t=>\t\"0,000\",\n                \"Stock\"\t\t\t=>\t\"1\",\n                \"CostUnitArticle\"\t=>\t\"\",\n                \"SerialNbKey\"\t\t=>\t\"0\",\n                \"TextComplementKey\"\t=>\t\"0\",\n                \"PartsListPrintKey\"\t=>\t\"\",\n                \"Prod\"\t\t\t=>\t\"0000000000\"\n            )\n        ),\n        \"Payment\" => array(\n            \"PaymentKey\"\t\t=>\t\"0\",\n            \"ReminderKey\"\t\t=>\t\"00\",\n            \"PayTerms\" => array(\n                array(\n                    \"PayTerm\"\t\t=>\t\"1\",\n                    \"PayDays\"\t\t=>\t\"000\",\n                    \"CashDiscDays1\"\t=>\t\"000\",\n                    \"CashDiscDays2\"\t=>\t\"000\",\n                    \"CashDiscPer1\"\t=>\t\"0,00\",\n                    \"CashDiscPer2\"\t=>\t\"0,00\"\n                ),\n                array(\n                    \"PayTerm\"\t\t=>\t\"2\",\n                    \"PayDays\"\t\t=>\t\"000\",\n                    \"CashDiscDays1\"\t=>\t\"000\",\n                    \"CashDiscDays2\"\t=>\t\"000\",\n                    \"CashDiscPer1\"\t=>\t\"0,00\",\n                    \"CashDiscPer2\"\t=>\t\"0,00\"\n                )\n            )\n        ),\n        \"NetAmountByTurnOverTax\" => array(\n            array(\n                \"TurnOverTaxFree\"\t=>\t\"145,72\",\n                \"TurnOverTax1\"\t\t=>\t\"0,00\",\n                \"TurnOverTax2\"\t\t=>\t\"0,00\",\n                \"TurnOverTax3\"\t\t=>\t\"0,00\",\n                \"TurnOverTax4\"\t\t=>\t\"0,00\",\n                \"TurnOverTax5\"\t\t=>\t\"0,00\",\n                \"TurnOverTax6\"\t\t=>\t\"0,00\",\n                \"TurnOverTax7\"\t\t=>\t\"0,00\",\n                \"TurnOverTax8\"\t\t=>\t\"0,00\"\n            ),\n        ),\n        \"GrossAmount\"\t\t\t=>\t\"145,72\",\n        \"ProceedAmount\"\t\t\t=>\t\"145,72\",\n        \"NetAmountByPayTerm2\" => array(\n            array(\n                \"Sum0\"\t\t\t=>\t\"0,00\",\n                \"Sum1\"\t\t\t=>\t\"0,00\",\n                \"Sum2\"\t\t\t=>\t\"0,00\",\n                \"Sum3\"\t\t\t=>\t\"0,00\",\n                \"Sum4\"\t\t\t=>\t\"0,00\",\n                \"Sum5\"\t\t\t=>\t\"0,00\",\n                \"Sum6\"\t\t\t=>\t\"0,00\",\n                \"Sum7\"\t\t\t=>\t\"0,00\",\n                \"Sum8\"\t\t\t=>\t\"0,00\"\n            ),\n        ),\n        \"TaxCodes\" => array(\n            array(\n                \"TaxCode1\"\t\t=>\t\"0\",\n                \"TaxCode2\"\t\t=>\t\"0\",\n                \"TaxCode3\"\t\t=>\t\"0\",\n                \"TaxCode4\"\t\t=>\t\"0\",\n                \"TaxCode5\"\t\t=>\t\"0\",\n                \"TaxCode6\"\t\t=>\t\"0\",\n                \"TaxCode7\"\t\t=>\t\"0\",\n                \"TaxCode8\"\t\t=>\t\"0\"\n            )\n        )\n    );\n    $docs = array(\n        array(\n            \"Version\"\t\t\t=>\t\"1.0\",\n            \"ProducerName\"\t\t\t=>\t\"xxxxxxxx\",\n            \"ProductName\"\t\t\t=>\t\"Classic Line\",\n            \"xmlns\"\t\t\t\t=>\t\"x-schema:CL310_DezABFSchema.XML\"\n        ),\n        \"Company\" => array(\n            array(\n                \"MandateNumber\"\t\t=>\t\"111\",\n                \"MandateName\"  \t\t=>\t\"xxx xxxxxxx-xxxxx xxxxxxx\",\n                \"MandateCurr\"  \t\t=>\t\"EUR\"\n            ),\n        ),\n        \"Doc\" => $order\n    );\n    dump2xml($docs);\nfunction dump2xml($array) {\n    // output of this goes through 2xml\n    array_walk_recursive($array, \"gen_xml\", \"/Docs/\");\n}\nfunction gen_xml($val, $key, $prefix)\n{\n    global $xml_fd;\n    print \"gen_xml(prefix=$prefix)\\n\";\n    if (is_array($val)) {\n    if (preg_match('/^\\d+$/', $key)) {\n        if ($key == 1) {\n        print substr($prefix, 0, -1) . \"\\n\";\n        }\n        array_walk_recursive($val, \"gen_xml\", \"$prefix@\");\n    }\n    else {\n        array_walk_recursive($val, \"gen_xml\", \"$prefix$key/\");\n    }\n    }\n    else {\n        if (strlen($val) > 0)\n        print \"$prefix$key=$val\\n\";\n        else\n        print \"$prefix$key\\n\";\n    }\n    print \"gen_xml(prefix=$prefix) end\\n\";\n}\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
