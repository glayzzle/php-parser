// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/lob_020.phpt
  it("oci_lob_write()/erase()/read() with CLOBs", function () {
    expect(parser.parseCode("<?php\nrequire __DIR__.'/connect.inc';\nrequire __DIR__.'/create_table.inc';\n$ora_sql = \"INSERT INTO\n                       \".$schema.$table_name.\" (Clob)\n                      VALUES (empty_Clob())\n                      RETURNING\n                               clob\n                      INTO :v_clob \";\n$statement = oci_parse($c,$ora_sql);\n$clob = oci_new_descriptor($c,OCI_D_LOB);\noci_bind_by_name($statement,\":v_clob\", $clob,-1,OCI_B_CLOB);\noci_execute($statement, OCI_DEFAULT);\nvar_dump($clob);\n$str = \"%0%0%0%0%0this is a biiiig faaat test string. why are you reading it, I wonder? =)\";\nvar_dump($clob->write($str));\nvar_dump($clob->erase(10,20));\noci_commit($c);\n$select_sql = \"SELECT clob FROM \".$schema.$table_name.\" FOR UPDATE\";\n$s = oci_parse($c, $select_sql);\noci_execute($s, OCI_DEFAULT);\nvar_dump($row = oci_fetch_array($s));\nvar_dump($row[0]->read(2));\nvar_dump($row[0]->read(5));\nvar_dump($row[0]->read(50));\nvar_dump($clob->erase());\necho \"\\nInvalid values\\n\";\necho \"\\nTest 1\\n\";\ntry {\n    var_dump($clob->erase(-10));\n} catch (ValueError $e) {\n    echo $e->getMessage(), \"\\n\";\n}\necho \"\\nTest 2\\n\";\ntry {\n    var_dump($clob->erase(10,-20));\n} catch (ValueError $e) {\n    echo $e->getMessage(), \"\\n\";\n}\necho \"\\nTest 3\\n\";\ntry {\n    var_dump($clob->erase(-10,-20));\n} catch (ValueError $e) {\n    echo $e->getMessage(), \"\\n\";\n}\necho \"\\nTest 4\\n\";\ntry {\n    // ORA-22990: LOB locators cannot span transactions\n    var_dump(oci_lob_erase($clob));\n} catch (ValueError $e) {\n    echo $e->getMessage(), \"\\n\";\n}\n    \necho \"\\nTest 5\\n\";\ntry {\n    var_dump(oci_lob_erase($clob,-10));\n} catch (ValueError $e) {\n    echo $e->getMessage(), \"\\n\";\n}\necho \"\\nTest 6\\n\";\ntry {\n    var_dump(oci_lob_erase($clob,10,-20));\n} catch (ValueError $e) {\n    echo $e->getMessage(), \"\\n\";\n}\necho \"\\nTest 7\\n\";\ntry {\n    var_dump(oci_lob_erase($clob,-10,-20));\n} catch (ValueError $e) {\n    echo $e->getMessage(), \"\\n\";\n}\necho \"\\nTest 8\\n\";\nunset($clob->descriptor);\nvar_dump(oci_lob_erase($clob,10,20));\nrequire __DIR__.'/drop_table.inc';\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
