// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/mysqli/tests/mysqli_options_int_and_float_native.phpt
  it("mysqli_options() - MYSQLI_OPT_INT_AND_FLOAT_NATIVE", function () {
    expect(parser.parseCode("<?php\n    require_once(\"connect.inc\");\n    $types = array(\n        'BIT' \t\t\t=> array('BIT(8)', 0),\n        'TINYINT'\t\t=> array('TINYINT', 120),\n        'BOOL'\t\t\t=> array('BOOL', 0),\n        'BOOLEAN'\t\t=> array('BOOLEAN', 1),\n        'SMALLINT'\t\t=> array('SMALLINT', 32000),\n        'MEDIUMINT'\t\t=> array('MEDIUMINT', 999),\n        'INT'\t\t\t=> array('INT', 999),\n        'BIGINT'\t\t=> array('BIGINT', 999),\n        'FLOAT'\t\t\t=> array('FLOAT', 1.3),\n        'DOUBLE'\t\t=> array('DOUBLE', -1.3),\n    );\n    foreach ($types as $name => $data) {\n        $link = mysqli_init();\n        if (!mysqli_options($link, MYSQLI_OPT_INT_AND_FLOAT_NATIVE, 1)) {\n            printf(\"[001] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n            continue;\n        }\n        if (!my_mysqli_real_connect($link, $host, $user, $passwd, $db, $port, $socket)) {\n            printf(\"[002] [%d] %s\\n\", mysqli_connect_errno(), mysqli_connect_error());\n            continue;\n        }\n        if (!mysqli_query($link, \"DROP TABLE IF EXISTS test\")) {\n            printf(\"[003] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n            continue;\n        }\n        if (!mysqli_query($link, sprintf(\"CREATE TABLE test (id %s)\", $data[0]))) {\n            printf(\"[004] TODO [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n            continue;\n        }\n        if (!mysqli_query($link, sprintf(\"INSERT INTO test(id) VALUES (%f)\", $data[1]))) {\n            printf(\"[005] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n            continue;\n        }\n        if (!$res = mysqli_query($link, \"SELECT id FROM test\")) {\n            printf(\"[006] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n            continue;\n        }\n        $row = mysqli_fetch_assoc($res);\n        mysqli_free_result($res);\n        if ($row['id'] !== $data[1]) {\n            printf(\"[007] Expecting %s - %s/%s got %s/%s\\n\",\n                $name,\n                $data[1], gettype($data[1]), $row['id'], gettype($row['id']));\n        }\n        mysqli_close($link);\n        $link = mysqli_init();\n        if (!mysqli_options($link, MYSQLI_OPT_INT_AND_FLOAT_NATIVE, 0)) {\n            printf(\"[008] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n            continue;\n        }\n        if (!my_mysqli_real_connect($link, $host, $user, $passwd, $db, $port, $socket)) {\n            printf(\"[009] [%d] %s\\n\", mysqli_connect_errno(), mysqli_connect_error());\n            continue;\n        }\n        if (!$res = mysqli_query($link, \"SELECT id FROM test\")) {\n            printf(\"[010] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n            continue;\n        }\n        $row = mysqli_fetch_assoc($res);\n        mysqli_free_result($res);\n        if (!is_string($row['id']) || ($row['id'] != $data[1])) {\n            printf(\"[011] Expecting %s - %s/string got %s/%s\\n\",\n                $name,\n                $data[1], $row['id'], gettype($row['id']));\n        }\n        mysqli_close($link);\n    }\n    print \"done!\";\n?>")).toMatchSnapshot();
  });
});
