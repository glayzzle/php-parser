// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/xmlreader/tests/003.phpt
  it("XMLReader: libxml2 XML Reader, attributes test", function () {
    expect(parser.parseCode("<?php\n$filename = __DIR__ . '/_003.xml';\n$xmlstring = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<books><book num=\"1\" idx=\"2\">book1</book></books>';\nfile_put_contents($filename, $xmlstring);\n$reader = new XMLReader();\nif (!$reader->open($filename)) {\n    exit();\n}\n// Only go through\nwhile ($reader->read()) {\n    if ($reader->nodeType != XMLREADER::END_ELEMENT) {\n        if ($reader->nodeType == XMLREADER::ELEMENT && $reader->hasAttributes) {\n            $attr = $reader->moveToFirstAttribute();\n            echo $reader->name . \": \";\n            echo $reader->value . \"\\n\";\n            if ($reader->getAttribute($reader->name) == $reader->value) {\n                echo \"1st attr (num) failed\\n\";\n            }\n            $attr = $reader->moveToNextAttribute();\n            echo $reader->name . \": \";\n            echo $reader->value . \"\\n\";\n            if ($reader->getAttribute($reader->name) == $reader->value) {\n                echo \"2nd attr (idx) failed\\n\";\n            }\n            // Named attribute\n            $attr = $reader->moveToAttribute('num');\n            echo $reader->name . \": \";\n            echo $reader->value . \"\\n\";\n            if ($reader->getAttribute('num') == $reader->value) {\n                echo \"attr num failed\\n\";\n            }\n            $attr = $reader->moveToAttribute('idx');\n            echo $reader->name . \": \";\n            echo $reader->value . \"\\n\";\n            if ($reader->getAttribute('idx') == $reader->value) {\n                echo \"attr idx failed\\n\";\n            }\n            // Numeric positions of attributes\n            $attr = $reader->moveToAttributeNo(0);\n            echo $reader->name . \": \";\n            echo $reader->value . \"\\n\";\n            if ($reader->getAttributeNo(0) == $reader->value) {\n                echo \"attr 0 failed\\n\";\n            }\n            $attr = $reader->moveToAttributeNo(1);\n            echo $reader->name . \": \";\n            echo $reader->value . \"\\n\";\n            var_dump($reader->moveToAttributeNo(20));\n            var_dump($reader->moveToAttribute('missing-attribute'));\n            try {\n                $reader->moveToAttribute('');\n            } catch (ValueError $exception) {\n                echo $exception->getMessage() . \"\\n\";\n            }\n        }\n    }\n}\n$reader->close();\nunlink($filename);\n?>")).toMatchSnapshot();
  });
});
