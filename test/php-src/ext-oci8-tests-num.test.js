// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/num.phpt
  it("oci_num_*() family", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.\"/connect.inc\");\n// Initialize\n$stmtarray = array(\n    \"drop table num_tab\",\n    \"create table num_tab (id number, value number)\",\n);\noci8_test_sql_execute($c, $stmtarray);\n// Run Test\necho \"Test 1\\n\";\n$insert_sql = \"insert into num_tab (id, value) values (1,1)\";\nif (!($s = oci_parse($c, $insert_sql))) {\n    die(\"oci_parse(insert) failed!\\n\");\n}\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\nfor ($i = 0; $i<3; $i++) {\n  if (!oci_execute($s)) {\n    die(\"oci_execute(insert) failed!\\n\");\n  }\n}\necho \"Test 2\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\nif (!oci_commit($c)) {\n  die(\"oci_commit() failed!\\n\");\n}\necho \"Test 3\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\n// All rows\n$select_sql = \"select * from num_tab\";\nif (!($s = oci_parse($c, $select_sql))) {\n  die(\"oci_parse(select) failed!\\n\");\n}\necho \"Test 4a\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\nif (!oci_execute($s)) {\n  die(\"oci_execute(select) failed!\\n\");\n}\necho \"Test 4b\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\nif (oci_fetch_all($s,$r) === false) {\n  die(\"oci_fetch_all(select) failed!\\n\");\n}\necho \"Test 4c\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\n// One row\n$select_sql = \"SELECT id, value FROM num_tab WHERE ROWNUM < 2\";\nif (!($s = oci_parse($c, $select_sql))) {\n  die(\"oci_parse(select) failed!\\n\");\n}\nif (!oci_execute($s)) {\n  die(\"oci_execute(select) failed!\\n\");\n}\nif (oci_fetch_all($s,$r) === false) {\n  die(\"oci_fetch_all(select) failed!\\n\");\n}\necho \"Test 5\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\n// No rows\n$select_sql = \"select id from num_tab where 1=0\";\nif (!($s = oci_parse($c, $select_sql))) {\n  die(\"oci_parse(select) failed!\\n\");\n}\nif (!oci_execute($s)) {\n  die(\"oci_execute(select) failed!\\n\");\n}\nif (oci_fetch_all($s,$r) === false) {\n  die(\"oci_fetch_all(select) failed!\\n\");\n}\necho \"Test 6\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\n$delete_sql = \"delete from num_tab\";\nif (!($s = oci_parse($c, $delete_sql))) {\n    die(\"oci_parse(delete) failed!\\n\");\n}\nif (!oci_execute($s)) {\n    die(\"oci_execute(delete) failed!\\n\");\n}\necho \"Test 7a\\n\";\nvar_dump(oci_num_rows($s));\nvar_dump(oci_num_fields($s));\noci_commit($c);\n// Cleanup\n$stmtarray = array(\n    \"drop table num_tab\"\n);\noci8_test_sql_execute($c, $stmtarray);\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
