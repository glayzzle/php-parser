// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/phar/tests/stat.phpt
  it("Phar: test stat function interceptions", function () {
    expect(parser.parseCode("<?php\numask(0);\nPhar::interceptFileFuncs();\nvar_dump(stat(\"\"));\n$fname = __DIR__ . '/' . basename(__FILE__, '.php') . '.phar.php';\n$fname2 = __DIR__ . '/' . basename(__FILE__, '.php') . '.tar';\n$fname3 = __DIR__ . '/' . basename(__FILE__, '.php') . '.phar.tar';\n$a = new Phar($fname);\n$a['my/index.php'] = '<?php\necho \"stat\\n\";\nvar_dump(stat(\"dir/file1.txt\"));\necho \"lstat\\n\";\nvar_dump(lstat(\"dir/file1.txt\"));\necho \"fileperms\\n\";\nvar_dump(fileperms(\"dir/file1.txt\"));\necho \"fileinode\\n\";\nvar_dump(fileinode(\"dir/file1.txt\"));\necho \"filesize\\n\";\nvar_dump(filesize(\"dir/file1.txt\"));\necho \"fileowner\\n\";\nvar_dump(fileowner(\"dir/file1.txt\"));\necho \"filegroup\\n\";\nvar_dump(filegroup(\"dir/file1.txt\"));\necho \"filemtime\\n\";\nvar_dump(filemtime(\"dir/file1.txt\"));\necho \"fileatime\\n\";\nvar_dump(fileatime(\"dir/file1.txt\"));\necho \"filectime\\n\";\nvar_dump(filectime(\"dir/file1.txt\"));\necho \"filetype\\n\";\nvar_dump(filetype(\"dir/file1.txt\"));\necho \"is_writable\\n\";\nvar_dump(is_writable(\"dir/file1.txt\"));\necho \"is_writeable\\n\";\nvar_dump(is_writeable(\"dir/file1.txt\"));\necho \"is_readable\\n\";\nvar_dump(is_readable(\"dir/file1.txt\"));\necho \"is_executable\\n\";\nvar_dump(is_executable(\"dir/file1.txt\"));\necho \"file_exists\\n\";\nvar_dump(file_exists(\"dir/file1.txt\"));\necho \"is_dir\\n\";\nvar_dump(is_dir(\"dir/file1.txt\"));\necho \"is_file\\n\";\nvar_dump(is_file(\"dir/file1.txt\"));\necho \"is_link\\n\";\nvar_dump(is_link(\"dir/file1.txt\"));\necho \"not found\\n\";\nvar_dump(file_exists(\"not/found\"));\necho \"not found 2\\n\";\nvar_dump(fileperms(\"not/found\"));\n?>';\n$a['dir/file1.txt'] = 'hi';\n$a['dir/file2.txt'] = 'hi2';\n$a['dir/file3.txt'] = 'hi3';\n$a->setStub('<?php\nset_include_path(\"phar://\" . __FILE__ . \"/dir\" . PATH_SEPARATOR . \"phar://\" . __FILE__);\ninclude \"my/index.php\";\n__HALT_COMPILER();');\ninclude $fname;\n?>")).toMatchSnapshot();
  });
});
