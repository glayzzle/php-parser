// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bug41069.phpt
  it("Bug #41069 (Oracle crash with certain data over a DB-link when prefetch memory limit used - Oracle bug 6039623)", function () {
    expect(parser.parseCode("    <?php\n    require(__DIR__.'/connect.inc');\n// Initialization\n$stmtarray = array(\n    \"alter session set nls_date_format = 'MM/DD/YYYY'\",\n    \"drop database link bug41069_dblink\",\n    \"drop table bug41069_tab\",\n    \"create shared database link bug41069_dblink authenticated by $user identified by $password using '$dbase'\",\n    \"create table bug41069_tab\n    (\n        c1  number(20),\n        c2  varchar2(60 byte),\n        c3  varchar2(1000 byte),\n        c4  varchar2(255 byte),\n        c5  varchar2(2 byte),\n        c6  varchar2(1 byte),\n        c7  varchar2(255 byte),\n        c8  varchar2(50 byte),\n        c9  date,\n        c10 date,\n        c12 number(20),\n        c13 varchar2(20 byte),\n        c15 varchar2(50 byte)\n     )\",\n    \"insert into bug41069_tab (c1, c2, c5, c6, c9, c10, c12, c15)\tvalues\n    (111, 'aaaaaaa', 'b', 'c', '01/17/2008', '01/07/2017', 2222, 'zzzzzzzzzz')\",\n    \"insert into bug41069_tab (c1, c2, c3, c4, c5, c6, c7, c9, c10, c12, c13, c15) values\n    (112, 'aaaaaaa', 'bbbbbbbb', 'ccccccc', 'd', 'e', 'rrrrrrr', '04/16/2007', '04/16/2007', 2223, 'xxxxxxxx', 'zzzzzzzz')\",\n    \"insert into bug41069_tab (c1, c2, c3, c4, c5, c6, c7, c9, c10, c12, c15)\tvalues\n    (113, 'aaaaaaa', 'bbbbbbbbbb', 'cccccc', 'e', 'f', 'dddd', '12/04/2006', '12/04/2006', 2224, 'zzzzzzz')\"\n);\noci8_test_sql_execute($c, $stmtarray);\n// Run Tests\necho \"Test 1: non-DB link case that always worked\\n\";\n$stid = oci_parse($c, 'select * from bug41069_tab order by c1');\noci_execute($stid, OCI_DEFAULT);\noci_fetch_all($stid, $results, 0, -1, OCI_ASSOC+OCI_FETCHSTATEMENT_BY_ROW);\nvar_dump($results);\necho \"Test 2: Should not crash\\n\";\n$stid = oci_parse($c, 'select * from bug41069_tab@bug41069_dblink order by c1');\noci_execute($stid, OCI_DEFAULT);\noci_fetch_all($stid, $results, 0, -1, OCI_ASSOC+OCI_FETCHSTATEMENT_BY_ROW);\nvar_dump($results);\n// Cleanup\n$c = oci_new_connect($user, $password, $dbase);\n$stmtarray = array(\n    \"drop database link bug41069_dblink\",\n    \"drop table bug41069_tab\"\n);\noci8_test_sql_execute($c, $stmtarray);\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
