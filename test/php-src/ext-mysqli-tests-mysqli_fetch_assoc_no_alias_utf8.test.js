// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/mysqli/tests/mysqli_fetch_assoc_no_alias_utf8.phpt
  it("mysqli_fetch_assoc() - utf8", function () {
    expect(parser.parseCode("<?php\n    require('table.inc');\n    /* some cyrillic (utf8) comes here */\n    if (!$res = mysqli_query($link, \"SET NAMES UTF8\")) {\n        printf(\"[001] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_query($link, \"SELECT 1 AS 'Андрей Христов', 2 AS 'Улф Вендел', 3 AS 'Георг Рихтер'\")) {\n        printf(\"[002] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[003]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    if (!$res = mysqli_query($link, \"CREATE TABLE автори_на_mysqlnd (id integer not null auto_increment primary key, име varchar(20) character set ucs2, фамилия varchar(20) character set utf8)\")) {\n        printf(\"[004] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_query($link, \"INSERT INTO автори_на_mysqlnd (име, фамилия) VALUES ('Андрей', 'Христов'), ('Георг', 'Рихтер'), ('Улф','Вендел')\")) {\n        printf(\"[005] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_query($link, \"INSERT INTO автори_на_mysqlnd (име, фамилия) VALUES ('Andrey', 'Hristov'), ('Georg', 'Richter'), ('Ulf','Wendel')\")) {\n        printf(\"[006] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_query($link, \"INSERT INTO автори_на_mysqlnd (име, фамилия) VALUES ('安德烈', 'Hristov'), ('格奥尔', 'Richter'), ('乌尔夫','Wendel')\")) {\n        printf(\"[007] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_query($link, \"SELECT id, име, фамилия FROM автори_на_mysqlnd ORDER BY фамилия, име\")) {\n        printf(\"[008] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[009]\\n\";\n    while ($row = mysqli_fetch_assoc($res)) {\n        var_dump($row);\n    }\n    mysqli_free_result($res);\n    if (!$res = mysqli_query($link, \"DROP TABLE автори_на_mysqlnd\")) {\n        printf(\"[010] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    mysqli_close($link);\n    print \"done!\";\n?>")).toMatchSnapshot();
  });
});
