// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bind_sqltint.phpt
  it("Bind with SQLT_INT", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.'/connect.inc');\n// Initialization\n$stmtarray = array(\n    \"drop table bind_sqltint_tab\",\n    \"create table bind_sqltint_tab (\n        id                number,\n        varchar2_t10      varchar2(10),\n        number_t          number,\n        number_t92        number(9,2))\",\n);\noci8_test_sql_execute($c, $stmtarray);\nfunction check_col($c, $colname, $id)\n{\n    $s = oci_parse($c, \"select $colname from bind_sqltint_tab where id = :id\");\n    oci_bind_by_name($s, \":id\", $id);\n    oci_execute($s);\n    oci_fetch_all($s, $r);\n    var_dump($r);\n}\n// Run Test\necho \"\\nTEST141 wrong bind type SQLT_INT\\n\";\n$c2 = \"Hood141\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, varchar2_t10) VALUES (141, :c2)\");\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'varchar2_t10', 141);\necho \"\\nTEST142 insert numbers SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t) VALUES (142, :n1)\");\n$n1 = 42;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t', 142);\necho \"\\nTEST143 insert numbers, SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t) VALUES (143, :n1)\");\n$n1 = 42.69;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t', 143);\necho \"\\nTEST144 insert numbers with SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t) VALUES (144, :n1)\");\n$n1 = 0;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t', 144);\necho \"\\nTEST145 insert numbers with SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t) VALUES (145, :n1)\");\n$n1 = -23;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t', 145);\necho \"\\nTEST146 insert numbers\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t) VALUES (146, :n1)\");\n$n1 = \"-23\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t', 146);\necho \"\\nTEST147 insert numbers with SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t) VALUES (147, :n1)\");\n$n1 = \"23\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t', 147);\necho \"\\nTEST148 insert numbers with SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t92) VALUES (148, :n1)\");\n$n1 = 123.56;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t92', 148);\necho \"\\nTEST149 insert numbers with SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t92) VALUES (149, :n1)\");\n$n1 = \"123.56\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t92', 149);\necho \"\\nTEST150 insert numbers with SQLT_INT\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltint_tab (id, number_t92) VALUES (150, :n1)\");\n$n1 = \"\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'number_t92', 150);\necho \"\\nTEST151 - 159 Initialization tests\\n\";\n$s = oci_parse($c, \"begin :p2 := :p1; end;\");\nunset($p1);\nunset($p2);\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST152\\n\";\nunset($p1);\n$p2 = null;\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST153\\n\";\nunset($p1);\n$p2 = 1111;\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST154\\n\";\n$p1 = null;\nunset($p2);\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST155\\n\";\n$p1 = null;\n$p2 = null;\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST156\\n\";\n$p1 = null;\n$p2 = 2222;\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST157\\n\";\n$p1 = 3333;\nunset($p2);\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST158\\n\";\n$p1 = 4444;\n$p2 = null;\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\necho \"\\nTEST159\\n\";\n$p1 = 5555;\n$p2 = 6666;\noci_bind_by_name($s, \":p1\", $p1, 10);\noci_bind_by_name($s, \":p2\", $p2, -1, SQLT_INT);\noci_execute($s);\nvar_dump($p2);\n// Clean up\n$stmtarray = array(\n    \"drop table bind_sqltint_tab\"\n);\noci8_test_sql_execute($c, $stmtarray);\n?>")).toMatchSnapshot();
  });
});
