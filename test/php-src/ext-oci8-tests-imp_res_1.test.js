// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/imp_res_1.phpt
  it("Oracle Database 12c Implicit Result Sets: basic test", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.'/connect.inc');\n// Initialization\n$stmtarray = array(\n    \"drop table imp_res_1_tab_1\",\n    \"create table imp_res_1_tab_1 (c1 number, c2 varchar2(10))\",\n    \"insert into imp_res_1_tab_1 values (1, 'abcde')\",\n    \"insert into imp_res_1_tab_1 values (2, 'fghij')\",\n    \"insert into imp_res_1_tab_1 values (3, 'klmno')\",\n    \"drop table imp_res_1_tab_2\",\n    \"create table imp_res_1_tab_2 (c3 varchar2(1))\",\n    \"insert into imp_res_1_tab_2 values ('t')\",\n    \"insert into imp_res_1_tab_2 values ('u')\",\n    \"insert into imp_res_1_tab_2 values ('v')\",\n    \"create or replace procedure imp_res_1_proc as\n      c1 sys_refcursor;\n    begin\n      open c1 for select * from imp_res_1_tab_1 order by 1;\n      dbms_sql.return_result(c1);\n      open c1 for select * from imp_res_1_tab_2 where rownum < 3 order by 1;\n      dbms_sql.return_result(c1);\n      open c1 for select 99 from dual;\n      dbms_sql.return_result (c1);\n      open c1 for select NULL, 'Z' from dual;\n      dbms_sql.return_result (c1);\n      open c1 for select * from imp_res_1_tab_1 order by 1;\n      dbms_sql.return_result(c1);\n    end;\"\n);\noci8_test_sql_execute($c, $stmtarray);\n// Run Test\necho \"Test 1 - oci_fetch_assoc\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_assoc($s)) != false)\n    var_dump($row);\necho \"\\nTest 2 - oci_fetch_object\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_object($s)) != false)\n    var_dump($row);\necho \"\\nTest 3 - oci_fetch_row\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_row($s)) != false)\n    var_dump($row);\necho \"\\nTest 4 - oci_fetch_array(OCI_ASSOC+OCI_RETURN_NULLS)\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_array($s, OCI_ASSOC+OCI_RETURN_NULLS)) != false)\n    var_dump($row);\necho \"\\nTest 5 - oci_fetch_array(OCI_ASSOC)\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_array($s, OCI_ASSOC)) != false)\n    var_dump($row);\necho \"\\nTest 6 - oci_fetch_array(OCI_NUM)\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_array($s, OCI_NUM)) != false)\n    var_dump($row);\necho \"\\nTest 7 - oci_fetch_array(OCI_BOTH)\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_array($s, OCI_BOTH)) != false)\n    var_dump($row);\necho \"\\nTest 8 - oci_fetch_array(OCI_BOTH+OCI_RETURN_NULLS)\\n\";\n$s = oci_parse($c, \"begin imp_res_1_proc(); end;\");\noci_execute($s);\nwhile (($row = oci_fetch_array($s, OCI_BOTH+OCI_RETURN_NULLS)) != false)\n    var_dump($row);\n// Clean up\n$stmtarray = array(\n    \"drop procedure imp_res_1_proc\",\n    \"drop table imp_res_1_tab_1\",\n    \"drop table imp_res_1_tab_2\"\n);\noci8_test_sql_execute($c, $stmtarray);\n?>")).toMatchSnapshot();
  });
});
