// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/file/006_variation2.phpt
  it("Test fileperms() & chmod() functions: usage variation - misc. perms", function () {
    expect(parser.parseCode("<?php\n/* Testing with miscellaneous Permission */\necho \"*** Testing fileperms() & chmod() : usage variations ***\\n\";\n$file_name = __DIR__.\"/006_variation2.tmp\";\n$file_handle = fopen($file_name, \"w\");\nfclose($file_handle);\n$dir_name = __DIR__.\"/006_variation2\";\nmkdir($dir_name);\necho \"\\n*** Testing fileperms(), chmod() with miscellaneous permissions ***\\n\";\n$perms_array = array(\n  /* testing sticky bit */\n  07777,\n  00000,\n  01000,\n  011111,\n  /* negative  values as permission */\n  -0777, // permissions will be given as 2's complement form of -0777\n  -07777, // permissions will be given as 2's complement form of -07777\n  /* decimal values as permission  */\n  777, // permissions will be given as octal equivalent value of 777\n  7777, // permissions will be given as octal equivalent value of 7777\n  -7777, // permissions are given as 2's complement of octal equivalent of 7777\n  /* hex value as permission */\n  0x777, // permissions will be given as ocatal equivalent value of 0x777\n  0x7777,\n  /* strings notation of permission,  wont work properly */\n  \"r+w\",\n  \"r+w+x\",\n  \"u+rwx\",\n  \"u+rwx, g+rw, o+wx\"\n);\n$count = 1;\nforeach($perms_array as $permission) {\n  echo \"-- Iteration $count --\\n\";\n  try {\n    var_dump( chmod($file_name, $permission) );\n    printf(\"%o\", fileperms($file_name) );\n    echo \"\\n\";\n    clearstatcache();\n  } catch (TypeError $e) {\n    echo $e->getMessage(), \"\\n\";\n  }\n  try {\n    var_dump( chmod($dir_name, $permission) );\n    printf(\"%o\", fileperms($dir_name) );\n    echo \"\\n\";\n    clearstatcache();\n  } catch (TypeError $e) {\n    echo $e->getMessage(), \"\\n\";\n  }\n  $count++;\n}\necho \"*** Done ***\\n\";\n?>")).toMatchSnapshot();
  });
});
