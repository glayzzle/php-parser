// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/file/005_variation-win32.phpt
  it("Test fileatime(), filemtime(), filectime() & touch() functions : usage variation", function () {
    expect(parser.parseCode("<?php\nfunction stat_fn( $filename ) {\n  echo \"-- File access time is => \";\n  print( @date( 'Y:M:D:H:i:s', fileatime($filename) ) ).\"\\n\";\n  clearstatcache();\n  echo \"-- File modification time is => \";\n  print( @date( 'Y:M:D:H:i:s', filemtime($filename) ) ).\"\\n\";\n  clearstatcache();\n  echo \"-- inode change time is => \";\n  print( @date( 'Y:M:D:H:i:s', filectime($filename) ) ).\"\\n\";\n  clearstatcache();\n}\necho \"*** Testing fileattime(), filemtime(), filectime() & touch() : usage variations ***\\n\";\n$file_path = __DIR__;\n// create files\n$file_handle = fopen(\"$file_path/005_variation1.tmp\", \"w\");\nfclose($file_handle);\nstat_fn(\"$file_path/005_variation1.tmp\");\nsleep(1);\n$file_handle = fopen(\"$file_path/005_variation2.tmp\", \"w\");\nfclose($file_handle);\nstat_fn(\"$file_path/005_variation2.tmp\");\nsleep(1);\n$file_handle = fopen(\"$file_path/005_variation3.tmp\", \"w\");\nfclose($file_handle);\nstat_fn(\"$file_path/005_variation3.tmp\");\n// delete files\nunlink(\"$file_path/005_variation1.tmp\");\nunlink(\"$file_path/005_variation2.tmp\");\nunlink(\"$file_path/005_variation3.tmp\");\necho \"\\n-- Checking different times, just after creating the file --\\n\";\n$file_name = \"$file_path/005_variation1.tmp\";\n$file_write_handle = fopen($file_name, \"w\");\nfclose($file_write_handle);\nstat_fn($file_name);\nsleep(1);\n/* filectime + 2 */\necho \"\\n-- Checking different times, after changing the file permission --\\n\";\nchmod($file_name, 0777);\nstat_fn($file_name);\nsleep(1);\n/* filemtime + 2 & filectime + 2 */\necho \"\\n-- Checking different times, after writing into the file --\\n\";\n$file_write_handle = fopen($file_name, \"w\");\nfwrite($file_write_handle, \"Hello, world\");\nfclose($file_write_handle);\nstat_fn($file_name);\nsleep(1);\n/* fileatime + 2 */\necho \"\\n-- Checking different times, after reading from the file --\\n\";\n$file_read_handle = fopen($file_name ,\"r\");\nfread($file_read_handle, 10);\nfclose( $file_read_handle);\nstat_fn($file_name);\nsleep(1);\n/* No change */\necho \"\\n-- Checking same times, after creating a softlink to the file --\\n\";\nsymlink($file_name, \"$file_path/005_variation_softlink.tmp\");\nstat_fn($file_name);\nsleep(1);\n/* filectime + 2 */\necho \"\\n-- Checking different times, after creating a hardlink to the file --\\n\";\nlink($file_name, \"$file_path/005_variation_hardlink.tmp\");\nstat_fn($file_name);\nsleep(1);\n/* No change */\necho \"\\n-- Checking same times, after making a copy of the file --\\n\";\n$file_copy = \"$file_path/005_variation_copy.tmp\";\ncopy($file_name, $file_copy);\nstat_fn($file_name);\nsleep(1);\n/* fileatime + 2 */\necho \"\\n-- Checking different times, after performing is_file() operation on the file --\\n\";\nis_file($file_name);\nstat_fn($file_name);\nsleep(1);\necho \"\\n*** Testing touch() function with different time values ***\\n\";\n$file_name2 = $file_path.\"/005_variation_touch.tmp\";\n$file_handle = fopen($file_name2, \"w\");\nfclose($file_handle);\nsleep(1);\n/* Time is not mentioned */\nvar_dump( touch($file_name2) ); //set to current system time\nstat_fn($file_name2);\nsleep(1);\n/* set to access(creation time of the file) time */\nvar_dump( touch($file_name2, @date(fileatime($file_name2))) );\nstat_fn($file_name2);\nsleep(1);\n/* set to access time of $file_name2 */\nvar_dump( touch($file_path.\"/005_variation_touch_fly.tmp\", @date(fileatime($file_name2)), time()) );\nstat_fn($file_name2);\nsleep(1);\n/* set to default value, with Invalid timestamps */\nvar_dump( touch($file_name2, 10) );\nstat_fn($file_name2);\nvar_dump( touch($file_name2, 10, 20) );\nstat_fn($file_name2);\n/* touch() after renaming the file */\nrename($file_name2, \"$file_path/005_variation_touch_new.tmp\");\nstat_fn(\"$file_path/005_variation_touch_new.tmp\");\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
