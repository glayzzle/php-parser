// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/fileinfo/tests/cve-2014-3538-mb.phpt
  it("Bug #66731: file: extensive backtracking", function () {
    expect(parser.parseCode("<?php\n$fd = __DIR__.'/cve-2014-3538私はガラスを食べられます.data';\nfile_put_contents($fd,\n  'try:' .\n  str_repeat(\"\\n\", 1000000));\n$fi = finfo_open(FILEINFO_NONE);\n$t = microtime(true);\nvar_dump(finfo_file($fi, $fd));\n$t = microtime(true) - $t;\nfinfo_close($fi);\nif ($t < 3) {\n    echo \"Ok\\n\";\n} else {\n    printf(\"Failed, time=%.2f\\n\", $t);\n}\n?>\nDone")).toMatchSnapshot();
  });
});
