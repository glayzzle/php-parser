// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/mysqli/tests/mysqli_get_warnings.phpt
  it("mysqli_get_warnings() - TODO", function () {
    expect(parser.parseCode("<?php\n    require_once(\"connect.inc\");\n    $tmp    = NULL;\n    $link   = NULL;\n    if (!is_null($tmp = @mysqli_get_warnings()))\n        printf(\"[001] Expecting NULL, got %s/%s\\n\", gettype($tmp), $tmp);\n    if (!is_null($tmp = @mysqli_get_warnings($link)))\n        printf(\"[002] Expecting NULL, got %s/%s\\n\", gettype($tmp), $tmp);\n    if (!is_null($tmp = @mysqli_get_warnings('')))\n        printf(\"[002] Expecting NULL, got %s/%s\\n\", gettype($tmp), $tmp);\n    if (!$link = my_mysqli_connect($host, $user, $passwd, $db, $port, $socket)) {\n        printf(\"[003] [%d] %s\\n\", mysqli_connect_errno(), mysqli_connect_error());\n    }\n    if (false !== ($tmp = mysqli_get_warnings($link))) {\n        printf(\"[004] Expecting boolean/false, got %s/%s\\n\", gettype($tmp), (is_object($tmp) ? var_dump($tmp, true) : $tmp));\n    }\n    if (!mysqli_query($link, \"DROP TABLE IF EXISTS test\"))\n        printf(\"[005] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    if (!mysqli_query($link, \"CREATE TABLE test (id SMALLINT)\"))\n        printf(\"[006] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    if (!mysqli_query($link, \"INSERT INTO test (id) VALUES (1000000)\"))\n        printf(\"[007] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    if (!is_object($warning = mysqli_get_warnings($link)) || 'mysqli_warning' != get_class($warning)) {\n        printf(\"[008] Expecting object/mysqli_warning, got %s/%s\\n\", gettype($tmp), (is_object($tmp) ? var_dump($tmp, true) : $tmp));\n    }\n    if (!method_exists($warning, 'next'))\n        printf(\"[009] Borked object, method next is missing\\n\");\n    $properties = array_merge(get_object_vars($warning), get_class_vars(get_class($warning)));\n    if (!empty($properties))\n        printf(\"[010] Properties have always been magic, hidden things - why are they visible now, a BC break...\\n\");\n    if ((!is_string($warning->message)) || ('' == $warning->message)) /* NULL or not there at all */\n        printf(\"[011] Expecting string/not empty, got %s/%s\\n\", gettype($warning->message), $warning->message);\n    if ((!is_string($warning->sqlstate)) || ('' == $warning->sqlstate)) /* NULL or not there at all */\n        printf(\"[012] Expecting string/not empty, got %s/%s\\n\", gettype($warning->sqlstate), $warning->sqlstate);\n    if ((!is_int($warning->errno)) || (0 == $warning->errno)) /* NULL or not there at all */\n        printf(\"[013] Expecting int/not 0, got %s/%s\\n\", gettype($warning->errno), $warning->errno);\n    if (false !== ($tmp = $warning->next()))\n        printf(\"[014] Expecting boolean/true, got %s/%s\\n\", gettype($tmp), $tmp);\n    if (!mysqli_query($link, \"INSERT INTO test (id) VALUES (1000000), (1000001)\"))\n        printf(\"[015] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    if (($tmp = mysqli_warning_count($link)) !== 2)\n        printf(\"[016] Expecting 2 warnings, got %d warnings\", $tmp);\n    if (!is_object($warning = mysqli_get_warnings($link)) || 'mysqli_warning' != get_class($warning)) {\n        printf(\"[017] Expecting object/mysqli_warning, got %s/%s\\n\", gettype($tmp), (is_object($tmp) ? var_dump($tmp, true) : $tmp));\n    }\n    if (true !== ($tmp = $warning->next()))\n        printf(\"[018] Expecting boolean/true, got %s/%s\\n\", gettype($tmp), $tmp);\n    if (false !== ($tmp = $warning->next()))\n        printf(\"[020] Expecting boolean/false, got %s/%s\\n\", gettype($tmp), $tmp);\n    mysqli_close($link);\n    if (!$mysqli = new my_mysqli($host, $user, $passwd, $db, $port, $socket))\n        printf(\"[021] Cannot create mysqli object: [%d] %s\\n\", mysqli_connect_errno(), mysqli_connect_error());\n    if (!$mysqli->query(\"DROP TABLE IF EXISTS t1\"))\n        printf(\"[022] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    if (!$mysqli->query(\"CREATE TABLE t1 (a smallint)\"))\n        printf(\"[023] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    if (!is_object($warning = new mysqli_warning($mysqli)))\n        printf(\"[024] Expecting object/mysqli_warning, got %s/%s\", gettype($warning), $warning);\n    if (!is_string($warning->message) || ('' == $warning->message))\n        printf(\"[025] Expecting string, got %s/%s\", gettype($warning->message), $warning->message);\n    if (!$mysqli->query(\"DROP TABLE t1\"))\n        printf(\"[026] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    /* Yes, I really want to check if the object property is empty */\n    if (!$mysqli = new my_mysqli($host, $user, $passwd, $db, $port, $socket))\n        printf(\"[027] Cannot create mysqli object: [%d] %s\\n\", mysqli_connect_errno(), mysqli_connect_error());\n    $warning = new mysqli_warning($mysqli);\n    if (false !== ($tmp = $warning->next()))\n        printf(\"[028] Expecting boolean/false, got %s/%s\\n\", gettype($tmp), $tmp);\n    if ('' != ($tmp = $warning->message))\n        printf(\"[029] Expecting string/empty, got %s/%s\\n\", gettype($tmp), $tmp);\n    if (!$mysqli = new my_mysqli($host, $user, $passwd, $db, $port, $socket))\n        printf(\"[030] Cannot create mysqli object: [%d] %s\\n\", mysqli_connect_errno(), mysqli_connect_error());\n    if (!$mysqli->query(\"DROP TABLE IF EXISTS t1\"))\n        printf(\"[031] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    if (!$mysqli->query(\"CREATE TABLE t1 (a smallint)\"))\n        printf(\"[032] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    /* out of range, three warnings */\n    if (!$mysqli->query(\"INSERT IGNORE INTO t1(a) VALUES (65536), (65536), (65536)\"))\n        printf(\"[033] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    $warning = new mysqli_warning($mysqli);\n        $i = 1;\n    while ($warning->next() && ('' != ($tmp = $warning->message))) {\n        $i++;\n    }\n    if (3 != $i)\n        printf(\"[034] Expecting three warnings, got %d warnings\\n\", $i);\n    $stmt = mysqli_stmt_init();\n    $warning = new mysqli_warning($stmt);\n    if (false !== ($tmp = $warning->next()))\n        printf(\"[035] Expecting boolean/false, got %s/%s\\n\", gettype($tmp), $tmp);\n    print \"done!\";\n?>\n<?php\nrequire_once(\"connect.inc\");\nif (!$link = my_mysqli_connect($host, $user, $passwd, $db, $port, $socket))\n   printf(\"[c001] [%d] %s\\n\", mysqli_connect_errno(), mysqli_connect_error());\nif (!mysqli_query($link, \"DROP TABLE IF EXISTS test\"))\n    printf(\"[c002] Cannot drop table, [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\nif (!mysqli_query($link, \"DROP TABLE IF EXISTS t1\"))\n    printf(\"[c003] Cannot drop table, [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\nmysqli_close($link);\n?>")).toMatchSnapshot();
  });
});
