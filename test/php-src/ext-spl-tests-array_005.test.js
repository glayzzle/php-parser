// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/spl/tests/array_005.phpt
  it("SPL: ArrayObject/Iterator interaction", function () {
    expect(parser.parseCode("<?php\nclass Student\n{\n    private $id;\n    private $name;\n    public function __construct($id, $name)\n    {\n        $this->id = $id;\n        $this->name = $name;\n    }\n    public function __toString()\n    {\n        return $this->id . ', ' . $this->name;\n    }\n    public function getId()\n    {\n        return $this->id;\n    }\n}\nclass StudentIdFilter extends FilterIterator\n{\n    private $id;\n    public function __construct(ArrayObject $students, Student $other)\n    {\n        FilterIterator::__construct($students->getIterator());\n        $this->id = $other->getId();\n    }\n    public function accept(): bool\n    {\n        echo \"ACCEPT \".$this->current()->getId().\" == \".$this->id.\"\\n\";\n        return $this->current()->getId() == $this->id;\n    }\n}\nclass StudentList implements IteratorAggregate\n{\n    private $students;\n    public function __construct()\n    {\n        $this->students = new ArrayObject(array());\n    }\n    public function add(Student $student)\n    {\n        if (!$this->contains($student)) {\n            $this->students[] = $student;\n        }\n    }\n    public function contains(Student $student)\n    {\n        foreach ($this->students as $s)\n        {\n            if ($s->getId() == $student->getId()) {\n                return true;\n            }\n        }\n        return false;\n    }\n    public function getIterator(): Traversable {\n        return $this->students->getIterator();\n    }\n}\n$students = new StudentList();\n$students->add(new Student('01234123', 'Joe'));\n$students->add(new Student('00000014', 'Bob'));\n$students->add(new Student('00000014', 'Foo'));\nforeach ($students as $student) {\n    echo $student, \"\\n\";\n}\n?>")).toMatchSnapshot();
  });
});
