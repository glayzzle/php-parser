// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/assert/assert_variation.phpt
  it("assert() - variation  - test callback options using ini_get/ini_set/assert_options", function () {
    expect(parser.parseCode("<?php\nfunction f1()\n{\n    echo \"f1 called\\n\";\n}\nfunction f2()\n{\n    echo \"f2 called\\n\";\n}\nfunction f3()\n{\n    echo \"f3 called\\n\";\n}\nclass c1\n{\n    static function assert($file, $line, $unused, $desc)\n    {\n        echo \"Class assertion failed $line, \\\"$desc\\\"\\n\";\n    }\n}\necho \"Initial values: assert_options(ASSERT_CALLBACK) => [\".assert_options(ASSERT_CALLBACK).\"]\\n\";\necho \"Initial values: ini.get(\\\"assert.callback\\\") => [\".ini_get(\"assert.callback\").\"]\\n\";\nvar_dump($r2=assert(0 != 0));\necho\"\\n\";\necho \"Change callback function using ini.set and test return value \\n\";\nvar_dump($rv = ini_set(\"assert.callback\",\"f2\"));\necho \"assert_options(ASSERT_CALLBACK) => [\".assert_options(ASSERT_CALLBACK).\"]\\n\";\necho \"ini.get(\\\"assert.callback\\\") => [\".ini_get(\"assert.callback\").\"]\\n\";\nvar_dump($r2=assert(0 != 0));\necho\"\\n\";\necho \"Change callback function using assert_options and test return value \\n\";\nvar_dump($rv=assert_options(ASSERT_CALLBACK, \"f3\"));\necho \"assert_options(ASSERT_CALLBACK) => [\".assert_options(ASSERT_CALLBACK).\"]\\n\";\necho \"ini.get(\\\"assert.callback\\\") => [\".ini_get(\"assert.callback\").\"]\\n\";\nvar_dump($r2=assert(0 != 0));\necho\"\\n\";\necho \"Reset the name of the callback routine to a class method and check that it works\\n\";\nvar_dump($rc=assert_options(ASSERT_CALLBACK, \"c1\"));\necho \"assert_options(ASSERT_CALLBACK) => [\".assert_options(ASSERT_CALLBACK).\"]\\n\";\necho \"ini.get(\\\"assert.callback\\\") => [\".ini_get(\"assert.callback\").\"]\\n\";\nvar_dump($r2=assert(0 != 0));\necho\"\\n\";\necho \"Reset callback options to use a class method \\n\";\nvar_dump($rc = assert_options(ASSERT_CALLBACK,array(\"c1\",\"assert\")));\nvar_dump($rao=assert_options(ASSERT_CALLBACK));\necho \"ini.get(\\\"assert.callback\\\") => [\".ini_get(\"assert.callback\").\"]\\n\\n\";\nvar_dump($r2=assert(0 != 0));\necho\"\\n\";\necho \"Reset callback options to use an object method \\n\";\n$o = new c1();\nvar_dump($rc=assert_options(ASSERT_CALLBACK,array(&$o,\"assert\")));\nvar_dump($rao=assert_options(ASSERT_CALLBACK));\necho \"ini.get(\\\"assert.callback\\\") => [\".ini_get(\"assert.callback\").\"]\\n\\n\";\nvar_dump($r2=assert(0 != 0));\necho\"\\n\";\necho \"Set callback to something silly\\n\";\nassert_options(ASSERT_CALLBACK, 3.141);\nvar_dump($rao = assert_options(ASSERT_CALLBACK));\n?>")).toMatchSnapshot();
  });
});
