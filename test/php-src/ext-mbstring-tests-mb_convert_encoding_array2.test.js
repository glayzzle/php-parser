// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/mbstring/tests/mb_convert_encoding_array2.phpt
  it("Test mb_convert_encoding() function : Circular references", function () {
    expect(parser.parseCode("<?php\n/*\n * Test basic functionality of mb_convert_encoding()\n */\necho \"*** Testing mb_convert_encoding() : Circular references ***\\n\";\n//All strings are the same when displayed in their respective encodings\n$sjis_string[] = base64_decode('k/qWe4zqg2WDTINYg2eCxYK3gUIwMTIzNIJUglWCVoJXgliBQg==');\n$sjis_string[] = base64_decode('k/qWe4zqg2WDTINYg2eCxYK3gUIwMTIzNIJUglWCVoJXgliBQg==');\n$tmp = &$sjis_string;\n$sjis_string[] = $tmp;\n$jis_string[] = base64_decode('GyRCRnxLXDhsJUYlLSU5JUgkRyQ5ISMbKEIwMTIzNBskQiM1IzYjNyM4IzkhIxsoQg==');\n$jis_string[] = base64_decode('GyRCRnxLXDhsJUYlLSU5JUgkRyQ5ISMbKEIwMTIzNBskQiM1IzYjNyM4IzkhIxsoQg==');\n$tmp = &$jis_string;\n$jis_string[] = $tmp;\n$euc_jp_string[] = base64_decode('xvzL3LjspcalraW5pcikx6S5oaMwMTIzNKO1o7ajt6O4o7mhow==');\n$euc_jp_string[] = base64_decode('xvzL3LjspcalraW5pcikx6S5oaMwMTIzNKO1o7ajt6O4o7mhow==');\n$tmp = &$euc_jp_string;\n$euc_jp_string[] = $tmp;\n$utf8_string[] = base64_decode('5pel5pys6Kqe44OG44Kt44K544OI44Gn44GZ44CCMDEyMzTvvJXvvJbvvJfvvJjvvJnjgII=');\n$utf8_string[] = base64_decode('5pel5pys6Kqe44OG44Kt44K544OI44Gn44GZ44CCMDEyMzTvvJXvvJbvvJfvvJjvvJnjgII=');\n$tmp = &$utf8_string;\n$utf8_string[] = $tmp;\nfunction base64_encode_array($input) {\n    foreach ($input as $var) {\n        if (is_scalar($var))\n            $ret[] = base64_encode($var);\n    }\n    return $ret;\n}\necho \"\\n-- Convert to JIS --\\n\";\necho \"JIS encoded string in base64:\\n\";\nvar_dump(base64_encode_array($jis_string));\necho \"Converted Strings:\\n\";\nvar_dump(base64_encode_array(mb_convert_encoding($sjis_string, 'JIS', 'SJIS')));\nvar_dump(base64_encode_array(mb_convert_encoding($euc_jp_string, 'JIS', 'EUC-JP')));\nvar_dump(base64_encode_array(mb_convert_encoding($utf8_string, 'JIS', 'UTF-8')));\necho \"\\n-- Convert to EUC-JP --\\n\";\necho \"EUC-JP encoded string in base64:\\n\";\nvar_dump(base64_encode_array($euc_jp_string));\necho \"Converted Strings:\\n\";\nvar_dump(base64_encode_array(mb_convert_encoding($sjis_string, 'EUC-JP', 'SJIS')));\nvar_dump(base64_encode_array(mb_convert_encoding($jis_string, 'EUC-JP', 'JIS')));\nvar_dump(base64_encode_array(mb_convert_encoding($utf8_string, 'EUC-JP', 'UTF-8')));\necho \"\\n-- Convert to SJIS --\\n\";\necho \"SJIS encoded string in base64:\\n\";\nvar_dump(base64_encode_array($sjis_string));\necho \"Converted Strings:\\n\";\nvar_dump(base64_encode_array(mb_convert_encoding($jis_string, 'SJIS', 'JIS')));\nvar_dump(base64_encode_array(mb_convert_encoding($euc_jp_string, 'SJIS', 'EUC-JP')));\nvar_dump(base64_encode_array(mb_convert_encoding($utf8_string, 'SJIS', 'UTF-8')));\necho \"\\n-- Convert to UTF-8 --\\n\";\necho \"UTF-8 encoded string in base64:\\n\";\nvar_dump(base64_encode_array($utf8_string));\necho \"Converted Strings:\\n\";\nvar_dump(base64_encode_array(mb_convert_encoding($sjis_string, 'UTF-8', 'SJIS')));\nvar_dump(base64_encode_array(mb_convert_encoding($jis_string, 'UTF-8', 'JIS')));\nvar_dump(base64_encode_array(mb_convert_encoding($euc_jp_string, 'UTF-8', 'EUC-JP')));\necho \"Done\";\n?>")).toMatchSnapshot();
  });
});
