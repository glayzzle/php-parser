// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/pgsql/tests/28large_object_import_oid.phpt
  it("PostgreSQL import large object with given oid", function () {
    expect(parser.parseCode("<?php\ninclude('config.inc');\n$db = pg_connect($conn_str);\necho \"import LO from int\\n\";\npg_exec($db, 'begin');\n$oid = pg_lo_import($db, __FILE__, 21003);\nif (!$oid) echo (\"pg_lo_import() error\\n\");\nif ($oid != 21003) echo (\"pg_lo_import() wrong id\\n\");\npg_lo_unlink ($db, $oid);\npg_exec($db, 'commit');\necho \"import LO from string\\n\";\npg_exec($db, 'begin');\n$oid = pg_lo_import($db, __FILE__, \"21004\");\nif (!$oid) echo (\"pg_lo_import() error\\n\");\nif ($oid != 21004) echo (\"pg_lo_import() wrong id\\n\");\npg_lo_unlink ($db, $oid);\npg_exec($db, 'commit');\necho \"import LO using default connection\\n\";\npg_exec('begin');\n$oid = pg_lo_import($db, __FILE__, 21005);\nif (!$oid) echo (\"pg_lo_import() error\\n\");\nif ($oid != 21005) echo (\"pg_lo_import() wrong id\\n\");\npg_lo_unlink ($oid);\npg_exec('commit');\n/* Invalide OID */\ntry {\n    pg_lo_import(__FILE__, -15);\n} catch (\\ValueError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\ntry {\n    pg_lo_import($db, __FILE__, -15);\n} catch (\\ValueError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\ntry {\n    pg_lo_import(__FILE__, 'giberrish');\n} catch (\\ValueError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\ntry {\n    pg_lo_import($db, __FILE__, 'giberrish');\n} catch (\\ValueError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\ntry {\n    pg_lo_import(__FILE__, true);\n} catch (\\TypeError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\ntry {\n    pg_lo_import($db, __FILE__, []);\n} catch (\\TypeError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\ntry {\n    pg_lo_import($db, __FILE__, new stdClass());\n} catch (\\TypeError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\ntry {\n    pg_lo_import($db, __FILE__, $db);\n} catch (\\TypeError $e) {\n    echo $e->getMessage(), \\PHP_EOL;\n}\necho \"OK\";\n?>")).toMatchSnapshot();
  });
});
