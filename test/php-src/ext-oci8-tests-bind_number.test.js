// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bind_number.phpt
  it("Bind with NUMBER column variants", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.'/connect.inc');\n// Initialization\n$stmtarray = array(\n    \"drop table bind_number_tab\",\n    \"create table bind_number_tab (\n                    id\t\t\t\t  number,\n                    number_t6\t\t  number(6),\n                    float_t\t\t\t  float,\n                    binary_float_t\t  binary_float,\n                    binary_double_t\t  binary_double,\n                    decimal_t\t\t  decimal,\n                    integer_t\t\t  integer)\"\n);\noci8_test_sql_execute($c, $stmtarray);\nfunction check_col($c, $colname, $id)\n{\n    $s = oci_parse($c, \"select $colname from bind_number_tab where id = :id\");\n    oci_bind_by_name($s, \":id\", $id);\n    oci_execute($s);\n    oci_fetch_all($s, $r);\n    var_dump($r);\n}\n// Run Test\necho \"Test 1 - invalid number\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, number_t6) VALUES (1, :n1)\");\n$n1 = \"Hello\";\noci_bind_by_name($s, \":n1\", $n1);\noci_execute($s);\ncheck_col($c, \"number_t6\", 1);\necho \"\\nTEST66 insert a float\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, float_t) VALUES (66, :f1)\");\n$f1 = 123.456;\noci_bind_by_name($s, \":f1\", $f1);\noci_execute($s);\ncheck_col($c, 'float_t', 66);\necho \"\\nTEST67 insert a binary float\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, binary_float_t) VALUES (67, :f1)\");\n$f1 = 567.456;\noci_bind_by_name($s, \":f1\", $f1);\noci_execute($s);\ncheck_col($c, 'binary_float_t', 67);\necho \"\\nTEST69 insert a binary double\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, binary_double_t) VALUES (69, :f1)\");\n$f1 = 567.456;\noci_bind_by_name($s, \":f1\", $f1);\noci_execute($s);\ncheck_col($c, 'binary_double_t', 69);\necho \"\\nTEST71 insert a decimal\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, decimal_t) VALUES (71, :f1)\");\n$f1 = 123.789;\noci_bind_by_name($s, \":f1\", $f1);\noci_execute($s);\ncheck_col($c, 'decimal_t', 71);\necho \"\\nTEST72 insert a decimal\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, decimal_t) VALUES (72, :f1)\");\n$f1 = 123.789;\noci_bind_by_name($s, \":f1\", $f1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'decimal_t', 72);\necho \"\\nTEST73 insert a double\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, binary_double_t) VALUES (73, :f1)\");\n$f1 = 483.589;\noci_bind_by_name($s, \":f1\", $f1);\noci_execute($s);\ncheck_col($c, 'binary_double_t', 73);\necho \"\\nTEST75 insert a INTEGER\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, integer_t) VALUES (75, :f1)\");\n$f1 = 589;\noci_bind_by_name($s, \":f1\", $f1);\noci_execute($s);\ncheck_col($c, 'integer_t', 75);\necho \"\\nTEST76 insert a INTEGER\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_number_tab (id, integer_t) VALUES (76, :f1)\");\n$f1 = 42;\noci_bind_by_name($s, \":f1\", $f1, -1, SQLT_INT);\noci_execute($s);\ncheck_col($c, 'integer_t', 76);\n// Clean up\n$stmtarray = array(\n    \"drop table bind_number_tab\"\n);\noci8_test_sql_execute($c, $stmtarray);\n?>")).toMatchSnapshot();
  });
});
