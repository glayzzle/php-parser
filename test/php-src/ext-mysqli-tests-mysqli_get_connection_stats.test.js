// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/mysqli/tests/mysqli_get_connection_stats.phpt
  it("mysqli_get_connection_stats()", function () {
    expect(parser.parseCode("<?php\n    require(\"table.inc\");\n    if (!is_array($info = mysqli_get_connection_stats($link)) || empty($info))\n        printf(\"[003] Expecting array/any_non_empty, got %s/%s\\n\", gettype($info), $info);\n    if (!is_array($info2 = mysqli_get_client_stats()) || empty($info2))\n        printf(\"[004] Expecting array/any_non_empty, got %s/%s\\n\", gettype($info2), $info2);\n    foreach ($info as $k => &$v) {\n        if (strpos($k, \"mem_\") === 0) {\n            $v = 0;\n        }\n    }\n    foreach ($info2 as $k => &$v) {\n        if (strpos($k, \"mem_\") === 0) {\n            $v = 0;\n        }\n    }\n    if ($info !== $info2) {\n        printf(\"[005] The hashes should be identical except of the memory related fields\\n\");\n        var_dump($info);\n        var_dump($info2);\n    }\n    if (!is_array($info = $link->get_connection_stats()) || empty($info))\n        printf(\"[006] Expecting array/any_non_empty, got %s/%s\\n\", gettype($info), $info);\n    foreach ($info as $k => &$v) {\n        if (strpos($k, \"mem_\") === 0) {\n            $v = 0;\n        }\n    }\n    if ($info !== $info2) {\n        printf(\"[007] The hashes should be identical except of the memory related fields\\n\");\n        var_dump($info);\n        var_dump($info2);\n    }\n    mysqli_close($link);\n    require(\"table.inc\");\n    if (!is_array($info = mysqli_get_connection_stats($link)) || empty($info))\n        printf(\"[008] Expecting array/any_non_empty, got %s/%s\\n\", gettype($info), $info);\n    if (!is_array($info2 = mysqli_get_client_stats()) || empty($info2))\n        printf(\"[009] Expecting array/any_non_empty, got %s/%s\\n\", gettype($info2), $info2);\n    // assuming the test is run in a plain-vanilla CLI environment\n    if ($info === $info2) {\n        printf(\"[010] The hashes should not be identical\\n\");\n        var_dump($info);\n        var_dump($info2);\n    }\n    print \"done!\";\n?>")).toMatchSnapshot();
  });
});
