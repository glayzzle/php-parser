// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/phar/tests/bug65028.phpt
  it("Phar - test specific manifest length", function () {
    expect(parser.parseCode("<?php\n$files = array(\n    \"lib/widgets/Widgets.php\",\n    \"lib/events/FormBeginEventArgs.php\",\n    \"lib/events/FormEndEventArgs.php\",\n    \"lib/Core.php\",\n    \"lib/database/MySqlDatabase.php\",\n    \"lib/utils/DateUtil.php\",\n    \"js/global.js\",\n    \"files/_emptyDirectory\",\n    \"files/search/schema.xml\",\n    \"vendor/Fusonic/Linq/Internal/WhereIterator.php\",\n    \"vendor/Fusonic/Linq/Internal/SelectManyIterator.php\",\n    \"vendor/Fusonic/Linq/Internal/SelectIterator.php\",\n    \"vendor/Fusonic/Linq/Internal/DiffIterator.php\",\n    \"vendor/Fusonic/Linq/Internal/GroupIterator.php\",\n    \"vendor/Fusonic/Linq/Internal/DistinctIterator.php\",\n    \"vendor/Fusonic/Linq/Internal/LinqHelper.php\",\n    \"vendor/Fusonic/Linq/Internal/OrderIterator.php\",\n    \"vendor/Fusonic/Linq/Internal/IntersectIterator.php\",\n    \"vendor/Fusonic/Linq/GroupedLinq.php\",\n    \"vendor/Fusonic/Linq.php\",\n    \"vendor/Fusonic/UI/Widgets/Forms/FormBegin.php\",\n    \"vendor/Fusonic/UI/Widgets/Forms/FormSectionBuilder.php\",\n    \"vendor/Fusonic/UI/Widgets/Forms/AutoSelect.php\",\n    \"vendor/Fusonic/UI/Widgets/Forms/ControlGroup.php\",\n    \"vendor/Fusonic/UI/Widgets/Forms/FormEnd.php\",\n    \"vendor/Fusonic/UI/Widgets/WidgetBase.php\",\n    \"modules/calendar/ajax/calendarGetInvitedUsersContentAjaxHandler.php\",\n    \"modules/calendar/js/calendarAppointmentForm.js\",\n    \"modules/calendar/misc/calendarAppointment.php\",\n    \"modules/calendar/pages/forms/calendarAppointmentForm.php\",\n    \"modules/calendar/setup/config.xml\",\n    \"modules/cmt/js/cmtMicroCommentsWidget.js\",\n    \"modules/cmt/setup/config.xml\",\n    \"modules/meta/misc/metaContentHelper.php\",\n    \"modules/meta/setup/config.xml\",\n    \"modules/brd/misc/brdPostStreamFormatter.php\",\n    \"modules/brd/misc/brdPost.php\",\n    \"modules/brd/setup/config/streamContents.xml\",\n    \"modules/brd/setup/resources/lang/en.xml\",\n    \"modules/brd/setup/resources/lang/de.xml\",\n    \"modules/brd/setup/config.xml\",\n    \"modules/auth/misc/authLoginService.php\",\n    \"modules/auth/setup/config.xml\",\n    \"modules/bwd/cache/bwdWordCacheCreator.php\",\n    \"modules/bwd/bwd.php\",\n    \"modules/bwd/setup/config.xml\",\n    \"modules/nws/templates/pages/forms/nwsNewsForm.tpl\",\n    \"modules/nws/templates/pages/nwsShowNewsPage.tpl\",\n    \"modules/nws/pages/forms/nwsNewsForm.php\",\n    \"modules/nws/pages/nwsShowNewsPage.php\",\n    \"modules/nws/setup/config.xml\",\n    \"modules/gmp/cache/gmpMarkersCacheCreator.php\",\n    \"modules/gmp/select/gmpMapContentSelect.php\",\n    \"modules/gmp/templates/gmpShowAppointmentPage.tpl\",\n    \"modules/gmp/templates/gmpShowLinkPage.tpl\",\n    \"modules/gmp/setup/config.xml\",\n    \"modules/mul/cache/mulVideoPortalCacheCreator.php\",\n    \"modules/mul/misc/mulPermissionHelper.php\",\n    \"modules/mul/templates/widgets/mulFileEmbedWidget_Video_Flv.tpl\",\n    \"modules/mul/setup/config/mulUploadVideoPortalMatches.xml\",\n    \"modules/mul/setup/config.xml\",\n    \"modules/cat/select/catCategorySelect.php\",\n    \"modules/cat/misc/catCategory.php\",\n    \"modules/cat/templates/pages/forms/catCategoryForm.tpl\",\n    \"modules/cat/pages/forms/catEditCategoryForm.php\",\n    \"modules/cat/pages/forms/catAddCategoryForm.php\",\n    \"modules/cat/setup/config.xml\",\n    \"modules/sty/events/styPageShowEventHandler.php\",\n    \"modules/sty/misc/styBox.php\",\n    \"modules/sty/templates/pages/forms/styLayoutForm.tpl\",\n    \"modules/sty/templates/pages/forms/styBoxForm.tpl\",\n    \"modules/sty/templates/pages/forms/styVariantForm.tpl\",\n    \"modules/sty/setup/resources/lang/en.xml\",\n    \"modules/sty/setup/resources/lang/de.xml\",\n    \"modules/sty/setup/config.xml\",\n    \"modules/reg/misc/regRegistrationHelper.php\",\n    \"modules/reg/setup/config.xml\",\n    \"modules/not/misc/notEmailNotificationProvider.php\",\n    \"modules/not/setup/config.xml\",\n    \"modules/styfusonic/setup/config.xml\",\n    \"modules/sys/ajax/sysUserAutoSuggestSelectAjaxHandler.php\",\n    \"modules/sys/js/sysUserAutoSuggestSelect.js\",\n    \"modules/sys/select/sysPermissionSelect.php\",\n    \"modules/sys/misc/sysHtaccessConfigWriter.php\",\n    \"modules/sys/misc/sysUserRepository.php\",\n    \"modules/sys/setup/resources/lang/en.xml\",\n    \"modules/sys/setup/resources/lang/de.xml\",\n    \"modules/sys/setup/config.xml\",\n    \"modules/igr/boxes/igrGreatestEntriesBoxTab.php\",\n    \"modules/igr/boxes/igrTopRatedEntriesBoxTab.php\",\n    \"modules/igr/setup/config.xml\",\n    \"modules/rat/ajax/ratRateAjaxHandler.php\",\n    \"modules/rat/ajax/ratUnlikeAjaxHandler.php\",\n    \"modules/rat/setup/config.xml\",\n    \"modules/search/select/searchModuleSelect.php\",\n    \"modules/search/select/searchOrderSelect.php\",\n    \"modules/search/misc/searchResultFormatter.php\",\n    \"modules/search/misc/searchProviderSolr.php\",\n    \"modules/search/misc/searchProviderLucene.php\",\n    \"modules/search/misc/searchResultItem.php\",\n    \"modules/search/misc/searchProviderBase.php\",\n    \"modules/search/misc/searchIProvider.php\",\n    \"modules/search/templates/misc/searchResultFormatter.tpl\",\n    \"modules/search/templates/pages/searchIndexPage.tpl\",\n    \"modules/search/templates/pages/forms/searchSearchForm.tpl\",\n    \"modules/search/pages/forms/searchSearchForm.php\",\n    \"modules/search/css/searchResultFormatter.css\",\n    \"modules/search/setup/config/sysSettings.xml\",\n    \"modules/search/setup/resources/lang/en.xml\",\n    \"modules/search/setup/resources/lang/de.xml\",\n    \"modules/search/setup/config.xml\",\n    \"style/Fusonic/40components.css\",\n    \"style/_emptyDirectory\",\n    \"index.php\",\n//\t\"a\", // This will make the test pass\n);\n// Create Phar with the filenames above\n$phar = new Phar(__DIR__ . \"/bug65028.phar\");\nforeach($files as $file)\n{\n    $phar->addFromString($file, \"\");\n}\n// Copy phar\ncopy(__DIR__ . \"/bug65028.phar\", __DIR__ . \"/bug65028-copy.phar\");\n// Open phar\ntry\n{\n    $phar = new Phar(__DIR__ . \"/bug65028-copy.phar\");\n    echo \"No exception thrown.\\n\";\n}\ncatch(UnexpectedValueException $ex)\n{\n    echo \"Exception thrown: \" . $ex->getMessage() . \"\\n\";\n}\n?>")).toMatchSnapshot();
  });
});
