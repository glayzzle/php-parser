// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/fetch_array.phpt
  it("oci_fetch_array()", function () {
    expect(parser.parseCode("<?php\nrequire __DIR__.\"/connect.inc\";\nrequire __DIR__.'/create_table.inc';\n$insert_sql = \"INSERT INTO \".$schema.\"\".$table_name.\" (id, value) VALUES (1,1)\";\nif (!($s = oci_parse($c, $insert_sql))) {\n    die(\"oci_parse(insert) failed!\\n\");\n}\nfor ($i = 0; $i<3; $i++) {\n    if (!oci_execute($s)) {\n        die(\"oci_execute(insert) failed!\\n\");\n    }\n}\nif (!oci_commit($c)) {\n    die(\"oci_commit() failed!\\n\");\n}\necho \"Test 1\\n\";\n$select_sql = \"SELECT * FROM \".$schema.\"\".$table_name.\"\";\nif (!($s = oci_parse($c, $select_sql))) {\n    die(\"oci_parse(select) failed!\\n\");\n}\nif (!oci_execute($s)) {\n    die(\"oci_execute(select) failed!\\n\");\n}\nwhile ($row = oci_fetch_array($s)) {\n    var_dump($row);\n}\necho \"Test 2\\n\";\nif (!oci_execute($s)) {\n    die(\"oci_execute(select) failed!\\n\");\n}\nwhile ($row = oci_fetch_array($s, OCI_NUM)) {\n    var_dump($row);\n}\necho \"Test 3\\n\";\nif (!oci_execute($s)) {\n    die(\"oci_execute(select) failed!\\n\");\n}\nwhile ($row = oci_fetch_array($s, OCI_ASSOC)) {\n    var_dump($row);\n}\necho \"Test 4\\n\";\nif (!oci_execute($s)) {\n    die(\"oci_execute(select) failed!\\n\");\n}\nwhile ($row = oci_fetch_array($s, OCI_BOTH)) {\n    var_dump($row);\n}\necho \"Test 5\\n\";\nif (!oci_execute($s)) {\n    die(\"oci_execute(select) failed!\\n\");\n}\nwhile ($row = oci_fetch_array($s, OCI_RETURN_LOBS)) {\n    var_dump($row);\n}\necho \"Test 6\\n\";\nif (!oci_execute($s)) {\n    die(\"oci_execute(select) failed!\\n\");\n}\nwhile ($row = oci_fetch_array($s, OCI_RETURN_NULLS)) {\n    var_dump($row);\n}\necho \"Test 7\\n\";\nif (!oci_execute($s)) {\n    die(\"oci_execute(select) failed!\\n\");\n}\nwhile ($row = oci_fetch_array($s, OCI_NUM+OCI_RETURN_NULLS)) {\n    var_dump($row);\n}\nrequire __DIR__.'/drop_table.inc';\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
