// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bind_sqltafc.phpt
  it("Bind tests with SQLT_AFC", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.'/connect.inc');\n// Initialization\n$stmtarray = array(\n    \"drop table bind_sqltafc_tab\",\n    \"create table bind_sqltafc_tab (id number, char_t char(1), char_t10 char(10), varchar2_t10 varchar2(10), number_t number)\",\n    \"insert into bind_sqltafc_tab values (0, 'a', 'abcd', 'efghij', 1.1)\"\n);\noci8_test_sql_execute($c, $stmtarray);\n// Run Test\nfunction q($c, $id)\n{\n    $s = oci_parse($c, \"select * from bind_sqltafc_tab where id = $id\");\n    oci_execute($s);\n    oci_fetch_all($s, $r);\n    var_dump($r);\n}\necho \"Test 0 - base table creation without binds\\n\";\nq($c, 0);\necho \"\\nTest 1 - successful insert\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltafc_tab (id, char_t, char_t10, varchar2_t10, number_t) VALUES (1, :c2, :c3, :c4, :c5)\");\n$c2 = \"H\";\n$c3 = \"AAAAAAAAAA\";  // max length allowed in column\n$c4 = \"BBBBBBBBBB\";  // max length allowed in column\n$c5 = \"123.45\";\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_AFC);\noci_bind_by_name($s, \":c3\", $c3, -1, SQLT_AFC);\noci_bind_by_name($s, \":c4\", $c4, -1, SQLT_AFC);\noci_bind_by_name($s, \":c5\", $c5, -1, SQLT_AFC);\noci_execute($s);\nq($c, 1);\necho \"\\nTest 2 - Empty Strings\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltafc_tab (id, char_t, char_t10, varchar2_t10, number_t) VALUES (5, :c2, :c3, :c4, :c5)\");\n$c2 = \"\";\n$c3 = \"\";\n$c4 = \"\";\n$c5 = \"\";\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_AFC);\noci_bind_by_name($s, \":c3\", $c3, -1, SQLT_AFC);\noci_bind_by_name($s, \":c4\", $c4, -1, SQLT_AFC);\noci_bind_by_name($s, \":c5\", $c5, -1, SQLT_AFC);\noci_execute($s);\nq($c, 5);\necho \"\\nTest 3 - NULLs\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltafc_tab (id, char_t, char_t10, varchar2_t10, number_t) VALUES (6, :c2, :c3, :c4, :c5)\");\n$c2 = null;\n$c3 = null;\n$c4 = null;\n$c5 = null;\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_AFC);\noci_bind_by_name($s, \":c3\", $c3, -1, SQLT_AFC);\noci_bind_by_name($s, \":c4\", $c4, -1, SQLT_AFC);\noci_bind_by_name($s, \":c5\", $c5, -1, SQLT_AFC);\noci_execute($s);\nq($c, 6);\n// Clean up\n$stmtarray = array(\n    \"drop table bind_sqltafc_tab\"\n);\noci8_test_sql_execute($c, $stmtarray);\noci_close($c);\n?>")).toMatchSnapshot();
  });
});
