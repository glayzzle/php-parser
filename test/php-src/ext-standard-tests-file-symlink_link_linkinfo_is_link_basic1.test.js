// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/file/symlink_link_linkinfo_is_link_basic1.phpt
  it("Test symlink(), linkinfo(), link() and is_link() functions: basic functionality - link to files", function () {
    expect(parser.parseCode("<?php\n$file_path = __DIR__;\n// temp dir created in present working directory\n$dirname = \"symlink_link_linkinfo_is_link_basic1\";\nmkdir(\"$file_path/$dirname\");  // creating temp dir\n/* Creating soft/hard link to $filename created in temp directory $dirname\n   and checking linkinfo() and is_link() on the link created */\necho \"*** Testing symlink(), linkinfo(), link() and is_link() : basic functionality ***\\n\";\n// creating file in $dirname, links are created to the this file\n$filename = \"$file_path/$dirname/symlink_link_linkinfo_is_link_basic1.tmp\";\n$filename = fopen($filename, \"w\");\nfclose($filename);\n// name of the soft link created to $filename\n$sym_linkname = \"$file_path/$dirname/symlink_link_linkinfo_is_link_softlink_basic1.tmp\";\n// name of the hard link created to $filename\n$linkname = \"$file_path/$dirname/symlink_link_linkinfo_is_link_hardlink_basic1.tmp\";\n// filename stored in array with single and double slash notation in its path\n$files = array (\n  \"$file_path/$dirname/symlink_link_linkinfo_is_link_basic1.tmp\",\n  \"$file_path//$dirname//symlink_link_linkinfo_is_link_basic1.tmp\"\n);\n$counter = 1;\n/* create soft/hard link to  the file\n   and check linkinfo() and is_link() on the link created */\nforeach($files as $file) {\n  echo \"\\n-- Iteration $counter --\\n\";\n  echo \"-- Testing on soft links --\\n\";\n  // create soft link\n  var_dump( symlink($file, $sym_linkname) );\n  // checking information of link with linkinfo()\n  $linkinfo = linkinfo($sym_linkname);\n  var_dump( is_int($linkinfo) && $linkinfo !== -1 );\n  // checking if given file is soft link\n  var_dump( is_link($sym_linkname) );\n  // clear the cache\n  clearstatcache();\n  // testing on hard link\n  echo \"-- Testing on hard links --\\n\";\n  // creating hard link\n  var_dump( link($file, $linkname) );\n  // checking information of link with linkinfo()\n  $linkinfo = linkinfo($sym_linkname);\n  var_dump( is_int($linkinfo) && $linkinfo !== -1 );\n  // checking if given link is soft link; expected: false\n  var_dump( is_link($linkname) );\n  // clear the cache\n  clearstatcache();\n  // deleting the links\n  unlink($sym_linkname);\n  unlink($linkname);\n  $counter++;\n}\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
