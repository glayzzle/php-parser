// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/pcre/tests/005.phpt
  it("abusing preg_match_all() #2", function () {
    expect(parser.parseCode("<?php\n// this file is not used in the cron job\n// use it to test the gcc regex with the sample data provided\n$sampledata = \"\n/p2/var/php_gcov/PHP_4_4/ext/ming/ming.c: In function `zif_swfbitmap_init':\n/p2/var/php_gcov/PHP_4_4/ext/ming/ming.c:323: warning: assignment from incompatible pointer type\n/p2/var/php_gcov/PHP_4_4/ext/ming/ming.c: In function `zif_swftextfield_setFont':\n/p2/var/php_gcov/PHP_4_4/ext/ming/ming.c:2597: warning: passing arg 2 of `SWFTextField_setFont' from incompatible pointer type\n/p2/var/php_gcov/PHP_4_4/ext/oci8/oci8.c:1027: warning: `oci_ping' defined but not used\n/p2/var/php_gcov/PHP_4_4/ext/posix/posix.c: In function `zif_posix_getpgid':\n/p2/var/php_gcov/PHP_4_4/ext/posix/posix.c:484: warning: implicit declaration of function `getpgid'\n/p2/var/php_gcov/PHP_4_4/ext/posix/posix.c: In function `zif_posix_getsid':\n/p2/var/php_gcov/PHP_4_4/ext/posix/posix.c:506: warning: implicit declaration of function `getsid'\n/p2/var/php_gcov/PHP_4_4/ext/session/mod_files.c: In function `ps_read_files':\n/p2/var/php_gcov/PHP_4_4/ext/session/mod_files.c:302: warning: implicit declaration of function `pread'\n/p2/var/php_gcov/PHP_4_4/ext/session/mod_files.c: In function `ps_write_files':\n/p2/var/php_gcov/PHP_4_4/ext/session/mod_files.c:340: warning: implicit declaration of function `pwrite'\n/p2/var/php_gcov/PHP_4_4/ext/sockets/sockets.c: In function `zif_socket_get_option':\n/p2/var/php_gcov/PHP_4_4/ext/sockets/sockets.c:1862: warning: unused variable `timeout'\n/p2/var/php_gcov/PHP_4_4/ext/sockets/sockets.c: In function `zif_socket_set_option':\n/p2/var/php_gcov/PHP_4_4/ext/sockets/sockets.c:1941: warning: unused variable `timeout'\n/p2/var/php_gcov/PHP_4_4/regex/regexec.c:19: warning: `nope' defined but not used\n/p2/var/php_gcov/PHP_4_4/ext/standard/exec.c:50: warning: `php_make_safe_mode_command' defined but not used\n/p2/var/php_gcov/PHP_4_4/ext/standard/image.c: In function `php_handle_jpc':\n/p2/var/php_gcov/PHP_4_4/ext/standard/image.c:604: warning: unused variable `dummy_int'\n/p2/var/php_gcov/PHP_4_4/ext/standard/parsedate.c: In function `php_gd_parse':\n/p2/var/php_gcov/PHP_4_4/ext/standard/parsedate.c:1138: warning: implicit declaration of function `php_gd_lex'\n/p2/var/php_gcov/PHP_4_4/ext/standard/parsedate.y: At top level:\n/p2/var/php_gcov/PHP_4_4/ext/standard/parsedate.y:864: warning: return type defaults to `int'\n/p2/var/php_gcov/PHP_4_4/ext/sysvmsg/sysvmsg.c: In function `zif_msg_receive':\n/p2/var/php_gcov/PHP_4_4/ext/sysvmsg/sysvmsg.c:318: warning: passing arg 2 of `php_var_unserialize' from incompatible pointer type\n/p2/var/php_gcov/PHP_4_4/ext/yp/yp.c: In function `zif_yp_err_string':\n/p2/var/php_gcov/PHP_4_4/ext/yp/yp.c:372: warning: assignment discards qualifiers from pointer target type\nZend/zend_language_scanner.c:5944: warning: `yy_fatal_error' defined but not used\nZend/zend_language_scanner.c:2627: warning: `yy_last_accepting_state' defined but not used\nZend/zend_language_scanner.c:2628: warning: `yy_last_accepting_cpos' defined but not used\nZend/zend_language_scanner.c:2634: warning: `yy_more_flag' defined but not used\nZend/zend_language_scanner.c:2635: warning: `yy_more_len' defined but not used\nZend/zend_language_scanner.c:5483: warning: `yyunput' defined but not used\nZend/zend_language_scanner.c:5929: warning: `yy_top_state' defined but not used\nconflicts: 2 shift/reduce\nZend/zend_ini_scanner.c:457: warning: `yy_last_accepting_state' defined but not used\nZend/zend_ini_scanner.c:458: warning: `yy_last_accepting_cpos' defined but not used\nZend/zend_ini_scanner.c:1361: warning: `yyunput' defined but not used\n/p2/var/php_gcov/PHP_4_4/Zend/zend_alloc.c: In function `_safe_emalloc':\n/p2/var/php_gcov/PHP_4_4/Zend/zend_alloc.c:237: warning: long int format, size_t arg (arg 3)\n/p2/var/php_gcov/PHP_4_4/Zend/zend_alloc.c:237: warning: long int format, size_t arg (arg 4)\n/p2/var/php_gcov/PHP_4_4/Zend/zend_alloc.c:237: warning: long int format, size_t arg (arg 5)\n/p2/var/php_gcov/PHP_4_4/Zend/zend_ini.c:338: warning: `zend_ini_displayer_cb' defined but not used\next/mysql/libmysql/my_tempnam.o(.text+0x80): In function `my_tempnam':\n/p2/var/php_gcov/PHP_4_4/ext/mysql/libmysql/my_tempnam.c:115: warning: the use of `tempnam' is dangerous, better use `mkstemp'\next/mysql/libmysql/my_tempnam.o(.text+0x80): In function `my_tempnam':\n/p2/var/php_gcov/PHP_4_4/ext/mysql/libmysql/my_tempnam.c:115: warning: the use of `tempnam' is dangerous, better use `mkstemp'\next/ming/ming.o(.text+0xc115): In function `zim_swfmovie_namedAnchor':\n/p2/var/php_gcov/PHP_5_2/ext/ming/ming.c:2207: undefined reference to `SWFMovie_namedAnchor'\n/p2/var/php_gcov/PHP_5_2/ext/ming/ming.c:2209: undefined reference to `SWFMovie_xpto'\n/p2/var/php_gcov/PHP_5_2/ext/ming/ming.c:2259: undefined reference to `SWFMovie_foo'\next/ming/ming.o(.text+0x851): In function `zif_ming_setSWFCompression':\n/p2/var/php_gcov/PHP_5_2/ext/ming/ming.c:154: undefined reference to `Ming_setSWFCompression'\n\";\n    // Regular expression to select the error and warning information\n    // tuned for gcc 3.4, 4.0 and 4.1\n    $gcc_regex = '/^((.+)(\\(\\.text\\+0x[[:xdigit:]]+\\))?: In function [`\\'](\\w+)\\':\\s+)?'.\n        '((?(1)(?(3)[^:\\n]+|\\2)|[^:\\n]+)):(\\d+): (?:(error|warning):\\s+)?(.+)'.\n        str_repeat('(?:\\s+\\5:(\\d+): (?:(error|warning):\\s+)?(.+))?', 99). // capture up to 100 errors\n        '/mS';\nvar_dump(preg_match_all($gcc_regex, $sampledata, $m, PREG_SET_ORDER));\nprint_r($m);\n?>")).toMatchSnapshot();
  });
});
