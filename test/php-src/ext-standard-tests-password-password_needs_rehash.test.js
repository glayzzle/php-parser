// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/password/password_needs_rehash.phpt
  it("Test normal operation of password_needs_rehash()", function () {
    expect(parser.parseCode("<?php\n//-=-=-=-\n// Invalid Hash, always rehash\nvar_dump(password_needs_rehash('', PASSWORD_BCRYPT));\nvar_dump(password_needs_rehash('', 1));\nvar_dump(password_needs_rehash('', '2y'));\n// Valid, as it's an unknown algorithm\nvar_dump(password_needs_rehash('', PASSWORD_DEFAULT));\nvar_dump(password_needs_rehash('', 0));\nvar_dump(password_needs_rehash('', NULL));\n// Valid with cost the same\nvar_dump(password_needs_rehash('$2y$10$MTIzNDU2Nzg5MDEyMzQ1Nej0NmcAWSLR.oP7XOR9HD/vjUuOj100y', PASSWORD_BCRYPT, array('cost' => 10)));\n// Valid with cost the same, additional params\nvar_dump(password_needs_rehash('$2y$10$MTIzNDU2Nzg5MDEyMzQ1Nej0NmcAWSLR.oP7XOR9HD/vjUuOj100y', PASSWORD_BCRYPT, array('cost' => 10, 'foo' => 3)));\n// Invalid, different (lower) cost\nvar_dump(password_needs_rehash('$2y$10$MTIzNDU2Nzg5MDEyMzQ1Nej0NmcAWSLR.oP7XOR9HD/vjUuOj100y', PASSWORD_BCRYPT, array('cost' => 0)));\n// Invalid, different (higher) cost\nvar_dump(password_needs_rehash('$2y$10$MTIzNDU2Nzg5MDEyMzQ1Nej0NmcAWSLR.oP7XOR9HD/vjUuOj100y', PASSWORD_BCRYPT, array('cost' => 11)));\n// Valid with cost the default\n$cost = str_pad(PASSWORD_BCRYPT_DEFAULT_COST, 2, '0', STR_PAD_LEFT);\nvar_dump(password_needs_rehash('$2y$'.$cost.'$MTIzNDU2Nzg5MDEyMzQ1Nej0NmcAWSLR.oP7XOR9HD/vjUuOj100y', PASSWORD_BCRYPT));\n// Should Issue Needs Rehash, Since Foo is cast to 0...\nvar_dump(password_needs_rehash('$2y$10$MTIzNDU2Nzg5MDEyMzQ1Nej0NmcAWSLR.oP7XOR9HD/vjUuOj100y', PASSWORD_BCRYPT, array('cost' => 'foo')));\n// CRYPT_MD5\nvar_dump(password_needs_rehash(crypt('Example', '$1$'), PASSWORD_DEFAULT));\n// CRYPT_SHA512 with 5000\nvar_dump(password_needs_rehash(crypt('Example', '$6$rounds=5000$aa$'), PASSWORD_DEFAULT));\necho \"OK!\";\n?>")).toMatchSnapshot();
  });
});
