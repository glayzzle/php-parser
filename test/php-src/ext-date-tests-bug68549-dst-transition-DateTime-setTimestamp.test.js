// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/date/tests/bug68549-dst-transition-DateTime-setTimestamp.phpt
  it("Bug #68549 (setting timestamp around a DST transition)", function () {
    expect(parser.parseCode("<?php\n$timezonesWithTimestamps = [\n    'America/Los_Angeles' => [\n        // LANG=en_US TZ=\"America/Los_Angeles\" date --date=@<...>\n        // forward:\n        1615687199, // Sat Mar 13 17:59:59 PST 2021 (Sun Mar 14 01:59:59 UTC 2021)\n        1615687200, // Sat Mar 13 18:00:00 PST 2021 (Sun Mar 14 02:00:00 UTC 2021)\n        1615687201, // Sat Mar 13 18:00:01 PST 2021 (Sun Mar 14 02:00:01 UTC 2021)\n        1615690799, // Sat Mar 13 18:59:59 PST 2021 (Sun Mar 14 02:59:59 UTC 2021)\n        1615690800, // Sat Mar 13 19:00:00 PST 2021 (Sun Mar 14 03:00:00 UTC 2021)\n        1615690801, // Sat Mar 13 19:00:01 PST 2021 (Sun Mar 14 03:00:01 UTC 2021)\n        1615708799, // Sun Mar 13 23:59:59 PST 2021\n        1615708800, // Sun Mar 14 00:00:00 PST 2021\n        1615708801, // Sun Mar 14 00:00:01 PST 2021\n        1615712399, // Sun Mar 14 00:59:59 PST 2021\n        1615712400, // Sun Mar 14 01:00:00 PST 2021\n        1615712401, // Sun Mar 14 01:00:01 PST 2021\n        1615715999, // Sun Mar 14 01:59:59 PST 2021\n        1615716000, // Sun Mar 14 03:00:00 PDT 2021\n        1615716001, // Sun Mar 14 03:00:01 PDT 2021\n        1615719599, // Sun Mar 14 03:59:59 PDT 2021\n        1615719600, // Sun Mar 14 04:00:00 PDT 2021\n        1615719601, // Sun Mar 14 04:00:01 PDT 2021\n        // backward:\n        1636246799, // Sat Nov  6 17:59:59 PDT 2021 (Sun Nov  7 00:59:59 UTC 2021)\n        1636246800, // Sat Nov  6 18:00:00 PDT 2021 (Sun Nov  7 01:00:00 UTC 2021)\n        1636246801, // Sat Nov  6 18:00:01 PDT 2021 (Sun Nov  7 01:00:01 UTC 2021)\n        1636250399, // Sat Nov  6 18:59:59 PDT 2021 (Sun Nov  7 01:59:59 UTC 2021)\n        1636250400, // Sat Nov  6 19:00:00 PDT 2021 (Sun Nov  7 02:00:00 UTC 2021)\n        1636250401, // Sat Nov  6 19:00:01 PDT 2021 (Sun Nov  7 02:00:01 UTC 2021)\n        1636268399, // Sat Nov  6 23:59:59 PDT 2021\n        1636268400, // Sun Nov  7 00:00:00 PDT 2021\n        1636268401, // Sun Nov  7 00:00:01 PDT 2021\n        1636271999, // Sun Nov  7 00:59:59 PDT 2021\n        1636272000, // Sun Nov  7 01:00:00 PDT 2021\n        1636272001, // Sun Nov  7 01:00:01 PDT 2021\n        1636275599, // Sun Nov  7 01:59:59 PDT 2021\n        1636275600, // Sun Nov  7 01:00:00 PST 2021\n        1636275601, // Sun Nov  7 01:00:01 PST 2021\n        1636279199, // Sun Nov  7 01:59:59 PST 2021\n        1636279200, // Sun Nov  7 02:00:00 PST 2021\n        1636279201, // Sun Nov  7 02:00:01 PST 2021\n    ],\n    'Atlantic/Azores' => [\n        // LANG=en_US TZ=\"Atlantic/Azores\" date --date=@<...>\n        // forward:\n        1616889599, // Sat Mar 27 22:59:59 AZOT 2021 (Sat Mar 27 23:59:59 UTC 2021)\n        1616889600, // Sat Mar 27 23:00:00 AZOT 2021 (Sun Mar 28 00:00:00 UTC 2021)\n        1616889601, // Sat Mar 27 23:00:01 AZOT 2021 (Sun Mar 28 00:00:01 UTC 2021)\n        1616893199, // Sat Mar 27 23:59:59 AZOT 2021 (Sun Mar 28 00:59:59 UTC 2021)\n        1616893200, // Sun Mar 28 01:00:00 AZOST 2021 (Sun Mar 28 01:00:00 UTC 2021)\n        1616893201, // Sun Mar 28 01:00:01 AZOST 2021 (Sun Mar 28 01:00:01 UTC 2021)\n        1616896799, // Sun Mar 28 01:59:59 AZOST 2021\n        1616896800, // Sun Mar 28 02:00:00 AZOST 2021\n        1616896801, // Sun Mar 28 02:00:01 AZOST 2021\n        // backward:\n        1635638399, // Sat Oct 30 23:59:59 AZOST 2021 (Sat Oct 30 23:59:59 UTC 2021)\n        1635638400, // Sun Oct 31 00:00:00 AZOST 2021 (Sun Oct 31 00:00:00 UTC 2021)\n        1635638401, // Sun Oct 31 00:00:01 AZOST 2021 (Sun Oct 31 00:00:01 UTC 2021)\n        1635641999, // Sun Oct 31 00:59:59 AZOST 2021 (Sun Oct 31 00:59:59 UTC 2021)\n        1635642000, // Sun Oct 31 00:00:00 AZOT 2021 (Sun Oct 31 01:00:00 UTC 2021)\n        1635642001, // Sun Oct 31 00:00:01 AZOT 2021 (Sun Oct 31 01:00:01 UTC 2021)\n        1635645599, // Sun Oct 31 00:59:59 AZOT 2021\n        1635645600, // Sun Oct 31 01:00:00 AZOT 2021\n        1635645601, // Sun Oct 31 01:00:01 AZOT 2021\n    ],\n    'Europe/London' => [\n        // LANG=en_US TZ=\"Europe/London\" date --date=@<...>\n        // forward:\n        1616889599, // Sat Mar 27 23:59:59 GMT 2021\n        1616889600, // Sun Mar 28 00:00:00 GMT 2021\n        1616889601, // Sun Mar 28 00:00:01 GMT 2021\n        1616893199, // Sun Mar 28 00:59:59 GMT 2021 (Sun Mar 28 00:59:59 UTC 2021)\n        1616893200, // Sun Mar 28 02:00:00 BST 2021 (Sun Mar 28 01:00:00 UTC 2021)\n        1616893201, // Sun Mar 28 02:00:01 BST 2021 (Sun Mar 28 01:00:01 UTC 2021)\n        1616896799, // Sun Mar 28 02:59:59 BST 2021 (Sun Mar 28 01:59:59 UTC 2021)\n        1616896800, // Sun Mar 28 03:00:00 BST 2021 (Sun Mar 28 02:00:00 UTC 2021)\n        1616896801, // Sun Mar 28 03:00:01 BST 2021 (Sun Mar 28 02:00:01 UTC 2021)\n        // backward:\n        1635638399, // Sun Oct 31 00:59:59 BST 2021\n        1635638400, // Sun Oct 31 01:00:00 BST 2021\n        1635638401, // Sun Oct 31 01:00:01 BST 2021\n        1635641999, // Sun Oct 31 01:59:59 BST 2021 (Sun Oct 31 00:59:59 UTC 2021)\n        1635642000, // Sun Oct 31 01:00:00 GMT 2021 (Sun Oct 31 01:00:00 UTC 2021)\n        1635642001, // Sun Oct 31 01:00:01 GMT 2021 (Sun Oct 31 01:00:01 UTC 2021)\n        1635645599, // Sun Oct 31 01:59:59 GMT 2021 (Sun Oct 31 01:59:59 UTC 2021)\n        1635645600, // Sun Oct 31 02:00:00 GMT 2021 (Sun Oct 31 02:00:00 UTC 2021)\n        1635645601, // Sun Oct 31 02:00:01 GMT 2021 (Sun Oct 31 02:00:01 UTC 2021)\n    ],\n    'Europe/Amsterdam' => [\n        // LANG=en_US TZ=\"Europe/Amsterdam\" date --date=@<...>\n        // forward:\n        1616885999, // Sat Mar 27 23:59:59 CET 2021\n        1616886000, // Sun Mar 28 00:00:00 CET 2021\n        1616886001, // Sun Mar 28 00:00:01 CET 2021\n        1616889599, // Sun Mar 28 00:59:59 CET 2021\n        1616889600, // Sun Mar 28 01:00:00 CET 2021\n        1616889601, // Sun Mar 28 01:00:01 CET 2021\n        1616893199, // Sun Mar 28 01:59:59 CET 2021\n        1616893200, // Sun Mar 28 03:00:00 CEST 2021\n        1616893201, // Sun Mar 28 03:00:01 CEST 2021\n        1616896799, // Sun Mar 28 03:59:59 CEST 2021 (Sun Mar 28 01:59:59 UTC 2021)\n        1616896800, // Sun Mar 28 04:00:00 CEST 2021 (Sun Mar 28 02:00:00 UTC 2021)\n        1616896801, // Sun Mar 28 04:00:01 CEST 2021 (Sun Mar 28 02:00:01 UTC 2021)\n        1616900399, // Sun Mar 28 04:59:59 CEST 2021 (Sun Mar 28 02:59:59 UTC 2021)\n        1616900400, // Sun Mar 28 05:00:00 CEST 2021 (Sun Mar 28 03:00:00 UTC 2021)\n        1616900401, // Sun Mar 28 05:00:01 CEST 2021 (Sun Mar 28 03:00:01 UTC 2021)\n        // backward:\n        1635631199, // Sat Oct 30 23:59:59 CEST 2021\n        1635631200, // Sun Oct 31 00:00:00 CEST 2021\n        1635631201, // Sun Oct 31 00:00:01 CEST 2021\n        1635638399, // Sun Oct 31 01:59:59 CEST 2021\n        1635638400, // Sun Oct 31 02:00:00 CEST 2021\n        1635638401, // Sun Oct 31 02:00:01 CEST 2021\n        1635641999, // Sun Oct 31 02:59:59 CEST 2021\n        1635642000, // Sun Oct 31 02:00:00 CET 2021\n        1635642001, // Sun Oct 31 02:00:01 CET 2021\n        1635645599, // Sun Oct 31 02:59:59 CET 2021 (Sun Oct 31 01:59:59 UTC 2021)\n        1635645600, // Sun Oct 31 03:00:00 CET 2021 (Sun Oct 31 02:00:00 UTC 2021)\n        1635645601, // Sun Oct 31 03:00:01 CET 2021 (Sun Oct 31 02:00:01 UTC 2021)\n        1635649199, // Sun Oct 31 03:59:59 CET 2021 (Sun Oct 31 02:59:59 UTC 2021)\n        1635649200, // Sun Oct 31 04:00:00 CET 2021 (Sun Oct 31 03:00:00 UTC 2021)\n        1635649201, // Sun Oct 31 04:00:01 CET 2021 (Sun Oct 31 03:00:01 UTC 2021)\n    ],\n];\nforeach ($timezonesWithTimestamps as $timezone => $timestamps) {\n    foreach ($timestamps as $timestamp) {\n        $tz = new DateTimeZone($timezone);\n        $dt = new DateTime('now', $tz);\n        $dt->setTimestamp($timestamp);\n        printf(\"%s %d -> %d %s\\n\", $timezone, $timestamp, $dt->getTimestamp(), $dt->format(DateTimeInterface::ISO8601));\n    }\n}\n?>")).toMatchSnapshot();
  });
});
