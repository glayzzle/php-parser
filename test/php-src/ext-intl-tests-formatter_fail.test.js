// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/intl/tests/formatter_fail.phpt
  it("numfmt creation failures", function () {
    expect(parser.parseCode("<?php\nfunction err($fmt) {\n    if(!$fmt) {\n        echo var_export(intl_get_error_message(), true).\"\\n\";\n    }\n}\nfunction print_exception($e) {\n    echo \"\\n\" . get_class($e) . \": \" . $e->getMessage()\n       . \" in \" . $e->getFile() . \" on line \" . $e->getLine() . \"\\n\";\n}\nfunction crt($t, $l, $s) {\n    switch(true) {\n        case $t == \"O\":\n            try {\n                return new NumberFormatter($l, $s);\n            } catch (Throwable $e) {\n                print_exception($e);\n                return null;\n            }\n            break;\n        case $t == \"C\":\n            try {\n                return NumberFormatter::create($l, $s);\n            } catch (Throwable $e) {\n                print_exception($e);\n                return null;\n            }\n            break;\n        case $t == \"P\":\n            try {\n                return numfmt_create($l, $s);\n            } catch (Throwable $e) {\n                print_exception($e);\n                return null;\n            }\n            break;\n    }\n}\n$args = array(\n    array(null, null),\n    array(\"whatever\", 1234567),\n    array(array(), array()),\n    array(\"en\", -1),\n    array(\"en_US\", NumberFormatter::PATTERN_RULEBASED),\n);\ntry {\n    $fmt = new NumberFormatter();\n} catch (TypeError $e) {\n    print_exception($e);\n    $fmt = null;\n}\nerr($fmt);\ntry {\n    $fmt = numfmt_create();\n} catch (TypeError $e) {\n    print_exception($e);\n    $fmt = null;\n}\nerr($fmt);\ntry {\n    $fmt = NumberFormatter::create();\n} catch (TypeError $e) {\n    print_exception($e);\n    $fmt = null;\n}\nerr($fmt);\n$fmt = new NumberFormatter('en_US', NumberFormatter::DECIMAL);\ntry {\n    $fmt->__construct('en_US', NumberFormatter::DECIMAL);\n} catch (Error $e) {\n    print_exception($e);\n    $fmt = null;\n}\nerr($fmt);\nforeach($args as $arg) {\n    $fmt = crt(\"O\", $arg[0], $arg[1]);\n    err($fmt);\n    $fmt = crt(\"C\", $arg[0], $arg[1]);\n    err($fmt);\n    $fmt = crt(\"P\", $arg[0], $arg[1]);\n    err($fmt);\n}\n?>")).toMatchSnapshot();
  });
});
