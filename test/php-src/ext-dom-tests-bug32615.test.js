// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/dom/tests/bug32615.phpt
  it("Bug #32615 (Replacing and inserting Fragments)", function () {
    expect(parser.parseCode("<?php\n$dom = new DomDocument;\n$frag = $dom->createDocumentFragment();\n$frag->appendChild(new DOMElement('root'));\n$dom->appendChild($frag);\n$root = $dom->documentElement;\n$frag->appendChild(new DOMElement('first'));\n$root->appendChild($frag);\n$frag->appendChild(new DOMElement('second'));\n$root->appendChild($frag);\n$node = $dom->createElement('newfirst');\n$frag->appendChild($node);\n$root->replaceChild($frag, $root->firstChild);\nunset($frag);\n$frag = $dom->createDocumentFragment();\n$frag->appendChild(new DOMElement('newsecond'));\n$root->replaceChild($frag, $root->lastChild);\n$node = $frag->appendChild(new DOMElement('fourth'));\n$root->insertBefore($frag, NULL);\n$frag->appendChild(new DOMElement('third'));\n$node = $root->insertBefore($frag, $node);\n$frag->appendChild(new DOMElement('start'));\n$root->insertBefore($frag, $root->firstChild);\n$frag->appendChild(new DOMElement('newthird'));\n$root->replaceChild($frag, $node);\n$frag->appendChild(new DOMElement('newfourth'));\n$root->replaceChild($frag, $root->lastChild);\n$frag->appendChild(new DOMElement('first'));\n$root->replaceChild($frag, $root->firstChild->nextSibling);\n$root->removeChild($root->firstChild);\necho $dom->saveXML().\"\\n\";\nwhile ($root->hasChildNodes()) {\n   $root->removeChild($root->firstChild);\n}\n$frag->appendChild(new DOMElement('first'));\n$root->insertBefore($frag, $root->firstChild);\n$node = $frag->appendChild(new DOMElement('fourth'));\n$root->appendChild($frag);\n$frag->appendChild(new DOMElement('second'));\n$frag->appendChild(new DOMElement('third'));\n$root->insertBefore($frag, $node);\necho $dom->saveXML().\"\\n\";\n$frag = $dom->createDocumentFragment();\n$root = $dom->documentElement;\n$root->replaceChild($frag, $root->firstChild);\necho $dom->saveXML();\n?>")).toMatchSnapshot();
  });
});
