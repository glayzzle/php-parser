// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/pdo_mysql/tests/pdo_mysql_stmt_bindparam_types.phpt
  it("MySQL PDOStatement->bindParam() - SQL column types", function () {
    expect(parser.parseCode("<?php\n    require_once(__DIR__ . DIRECTORY_SEPARATOR . 'mysql_pdo_test.inc');\n    $db = MySQLPDOTest::factory();\n    MySQLPDOTest::createTestTable($db);\n    function pdo_mysql_stmt_bindparam_types_do($db, $offset, $native, $sql_type, $value) {\n            if ($native)\n                $db->setAttribute(PDO::MYSQL_ATTR_DIRECT_QUERY, 0);\n            else\n                $db->setAttribute(PDO::MYSQL_ATTR_DIRECT_QUERY, 1);\n            $db->exec('DROP TABLE IF EXISTS test');\n            $sql = sprintf('CREATE TABLE test(id INT, label %s) ENGINE=%s', $sql_type, MySQLPDOTest::getTableEngine());\n            if ((!$stmt = @$db->prepare($sql)) || (!@$stmt->execute()))\n                // Server might not support column type - skip it\n                return true;\n            $stmt = $db->prepare('INSERT INTO test(id, label) VALUES (1, ?)');\n            if (!$stmt->bindParam(1, $value)) {\n                printf(\"[%03d/%s + 1] %s\\n\", $offset, ($native) ? 'native' : 'emulated',\n                    var_export($stmt->errorInfo(), true));\n                return false;\n            }\n            if (!$stmt->execute()) {\n                printf(\"[%03d/%s + 2] %s\\n\", $offset, ($native) ? 'native' : 'emulated',\n                    var_export($stmt->errorInfo(), true));\n                return false;\n            }\n            $stmt = $db->query('SELECT id, label FROM test');\n            $id = $label = null;\n            if (!$stmt->bindColumn(1, $id)) {\n                printf(\"[%03d/%s + 3] %s\\n\", $offset, ($native) ? 'native' : 'emulated',\n                    var_export($stmt->errorInfo(), true));\n                return false;\n            }\n            if (!$stmt->bindColumn(2, $label)) {\n                printf(\"[%03d/%s + 4] %s\\n\", $offset, ($native) ? 'native' : 'emulated',\n                    var_export($stmt->errorInfo(), true));\n                return false;\n            }\n            if (!$stmt->fetch(PDO::FETCH_BOUND)) {\n                printf(\"[%03d/%s + 5] %s\\n\", $offset, ($native) ? 'native' : 'emulated',\n                    var_export($stmt->errorInfo(), true));\n                return false;\n            }\n            $stmt->closeCursor();\n            if ($label != $value) {\n                printf(\"[%03d/%s + 6] Got %s expecting %s - please check manually\\n\",\n                    $offset, ($native) ? 'native' : 'emulated',\n                    var_export($label, true), var_export($value, true));\n                // fall through\n            }\n            $stmt->execute();\n            $row = $stmt->fetch(PDO::FETCH_ASSOC);\n            if (empty($row)) {\n                printf(\"[%03d/%s + 7] %s\\n\", $offset, ($native) ? 'native' : 'emulated',\n                    var_export($stmt->errorInfo(), true));\n                return false;\n            }\n            if ($row['label'] != $value) {\n                printf(\"[%03d/%s + 8] Got %s expecting %s - please check manually\\n\",\n                    $offset, ($native) ? 'native' : 'emulated',\n                    var_export($row['label'], true), var_export($value, true));\n                return false;\n            }\n            if ($row['label'] != $label) {\n                printf(\"[%03d/%s + 9] Got %s from FETCH_ASSOC and %s from FETCH_BOUND- please check manually\\n\",\n                    $offset, ($native) ? 'native' : 'emulated',\n                    var_export($row['label'], true), var_export($value, true));\n                return false;\n            }\n            $db->exec('DROP TABLE IF EXISTS test');\n            return true;\n    }\n    function pdo_mysql_stmt_bindparam_types($db, $offset, $sql_type, $value) {\n        pdo_mysql_stmt_bindparam_types_do($db, $offset, true, $sql_type, $value);\n        pdo_mysql_stmt_bindparam_types_do($db, $offset, false, $sql_type, $value);\n    }\n    try {\n        // pdo_mysql_stmt_bindparam_types($db, 2, 'BIT(8)', 1);\n        pdo_mysql_stmt_bindparam_types($db, 3, 'TINYINT', -127);\n        pdo_mysql_stmt_bindparam_types($db, 4, 'TINYINT UNSIGNED', 255);\n        pdo_mysql_stmt_bindparam_types($db, 5, 'BOOLEAN', 1);\n        pdo_mysql_stmt_bindparam_types($db, 6, 'SMALLINT', -32768);\n        pdo_mysql_stmt_bindparam_types($db, 7, 'SMALLINT UNSIGNED', 65535);\n        pdo_mysql_stmt_bindparam_types($db, 8, 'MEDIUMINT', -8388608);\n        pdo_mysql_stmt_bindparam_types($db, 9, 'MEDIUMINT UNSIGNED', 16777215);\n        pdo_mysql_stmt_bindparam_types($db, 10, 'INT', -2147483648);\n        pdo_mysql_stmt_bindparam_types($db, 11, 'INT UNSIGNED', 4294967295);\n        pdo_mysql_stmt_bindparam_types($db, 12, 'BIGINT',  -1000);\n        pdo_mysql_stmt_bindparam_types($db, 13, 'BIGINT UNSIGNED', 1000);\n        pdo_mysql_stmt_bindparam_types($db, 14, 'REAL', -1000);\n        pdo_mysql_stmt_bindparam_types($db, 15, 'REAL UNSIGNED', 1000);\n        pdo_mysql_stmt_bindparam_types($db, 16, 'REAL ZEROFILL', '0000000000000000000000');\n        pdo_mysql_stmt_bindparam_types($db, 17, 'REAL UNSIGNED ZEROFILL', '0000000000000000000010');\n        pdo_mysql_stmt_bindparam_types($db, 18, 'DOUBLE', -1000);\n        pdo_mysql_stmt_bindparam_types($db, 19, 'DOUBLE UNSIGNED', 1000);\n        pdo_mysql_stmt_bindparam_types($db, 20, 'DOUBLE ZEROFILL', '000000000000');\n        pdo_mysql_stmt_bindparam_types($db, 21, 'DOUBLE ZEROFILL UNSIGNED', '000000001000');\n        pdo_mysql_stmt_bindparam_types($db, 22, 'FLOAT', -1000);\n        pdo_mysql_stmt_bindparam_types($db, 23, 'FLOAT UNSIGNED', 1000);\n        pdo_mysql_stmt_bindparam_types($db, 24, 'FLOAT ZEROFILL', '000000000000');\n        pdo_mysql_stmt_bindparam_types($db, 25, 'FLOAT ZEROFILL UNSIGNED', '000000001000');\n        pdo_mysql_stmt_bindparam_types($db, 26, 'DECIMAL', -1000);\n        pdo_mysql_stmt_bindparam_types($db, 27, 'DECIMAL UNSIGNED', 1000);\n        pdo_mysql_stmt_bindparam_types($db, 28, 'DECIMAL ZEROFILL', '000000000000');\n        pdo_mysql_stmt_bindparam_types($db, 29, 'DECIMAL ZEROFILL UNSIGNED', '000000001000');\n        pdo_mysql_stmt_bindparam_types($db, 30, 'NUMERIC', -1000);\n        pdo_mysql_stmt_bindparam_types($db, 31, 'NUMERIC UNSIGNED', 1000);\n        pdo_mysql_stmt_bindparam_types($db, 32, 'NUMERIC ZEROFILL', '000000000000');\n        pdo_mysql_stmt_bindparam_types($db, 33, 'NUMERIC ZEROFILL UNSIGNED', '000000001000');\n        pdo_mysql_stmt_bindparam_types($db, 34, 'DATE', '2008-04-23');\n        pdo_mysql_stmt_bindparam_types($db, 35, 'TIME', '16:43:12');\n        pdo_mysql_stmt_bindparam_types($db, 36, 'TIMESTAMP', '2008-04-23 16:44:53');\n        pdo_mysql_stmt_bindparam_types($db, 37, 'DATETIME', '2008-04-23 16:44:53');\n        pdo_mysql_stmt_bindparam_types($db, 38, 'YEAR', '2008');\n        pdo_mysql_stmt_bindparam_types($db, 39, 'CHAR(1)', 'a');\n        pdo_mysql_stmt_bindparam_types($db, 40, 'CHAR(255)', 'abc');\n        pdo_mysql_stmt_bindparam_types($db, 41, 'VARCHAR(255)', str_repeat('a', 255));\n        pdo_mysql_stmt_bindparam_types($db, 42, 'BINARY(255)', str_repeat('a', 255));\n        pdo_mysql_stmt_bindparam_types($db, 43, 'VARBINARY(255)', str_repeat('a', 255));\n        pdo_mysql_stmt_bindparam_types($db, 44, 'TINYBLOB', str_repeat('a', 255));\n        pdo_mysql_stmt_bindparam_types($db, 45, 'BLOB', str_repeat('b', 300));\n        pdo_mysql_stmt_bindparam_types($db, 46, 'MEDIUMBLOB', str_repeat('b', 300));\n        pdo_mysql_stmt_bindparam_types($db, 47, 'LONGBLOB', str_repeat('b', 300));\n        pdo_mysql_stmt_bindparam_types($db, 48, 'TINYTEXT', str_repeat('c', 255));\n        pdo_mysql_stmt_bindparam_types($db, 49, 'TINYTEXT BINARY', str_repeat('c', 255));\n        pdo_mysql_stmt_bindparam_types($db, 50, 'TEXT', str_repeat('d', 300));\n        pdo_mysql_stmt_bindparam_types($db, 51, 'TEXT BINARY', str_repeat('d', 300));\n        pdo_mysql_stmt_bindparam_types($db, 52, 'MEDIUMTEXT', str_repeat('d', 300));\n        pdo_mysql_stmt_bindparam_types($db, 53, 'MEDIUMTEXT BINARY', str_repeat('d', 300));\n        pdo_mysql_stmt_bindparam_types($db, 54, 'LONGTEXT', str_repeat('d', 300));\n        pdo_mysql_stmt_bindparam_types($db, 55, 'LONGTEXT BINARY', str_repeat('d', 300));\n        pdo_mysql_stmt_bindparam_types($db, 56, \"ENUM('yes', 'no') DEFAULT 'yes'\", \"no\");\n        pdo_mysql_stmt_bindparam_types($db, 57, \"SET('yes', 'no') DEFAULT 'yes'\", \"no\");\n    } catch (PDOException $e) {\n        printf(\"[001] %s [%s] %s\\n\",\n            $e->getMessage(), $db->errorCode(), implode(' ', $db->errorInfo()));\n    }\n    print \"done!\";\n?>")).toMatchSnapshot();
  });
});
