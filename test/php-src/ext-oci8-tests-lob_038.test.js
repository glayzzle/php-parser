// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/lob_038.phpt
  it("Array fetch CLOB and BLOB", function () {
    expect(parser.parseCode("<?php\nrequire __DIR__.'/connect.inc';\nrequire __DIR__.'/create_table.inc';\necho \"Test 1: CLOB\\n\";\n$ora_sql = \"INSERT INTO\n                       \".$schema.$table_name.\" (clob)\n                      VALUES (empty_clob())\n                      RETURNING\n                               clob\n                      INTO :v_clob \";\n$s = oci_parse($c,$ora_sql);\n$clob = oci_new_descriptor($c,OCI_DTYPE_LOB);\noci_bind_by_name($s,\":v_clob\", $clob,-1,OCI_B_CLOB);\noci_execute($s, OCI_DEFAULT);\nvar_dump($clob->save(\"clob test 1\"));\noci_execute($s, OCI_DEFAULT);\nvar_dump($clob->save(\"clob test 2\"));\noci_execute($s, OCI_DEFAULT);\nvar_dump($clob->save(\"clob test 3\"));\n$s = oci_parse($c,\"select clob from \".$schema.$table_name);\nvar_dump(oci_execute($s));\noci_fetch_all($s, $res);\nvar_dump($res);\necho \"Test 1b\\n\";\n$s = oci_parse($c, \"select clob from \".$schema.$table_name);\nvar_dump(oci_execute($s, OCI_DEFAULT));\nwhile ($row = oci_fetch_array($s, OCI_ASSOC)) {\n    var_dump($row);\n    $result = $row['CLOB']->load();\n    var_dump($result);\n}\nrequire __DIR__.'/drop_table.inc';\necho \"Test 2: BLOB\\n\";\nrequire __DIR__.'/create_table.inc';\n$ora_sql = \"INSERT INTO\n                       \".$schema.$table_name.\" (blob)\n                      VALUES (empty_blob())\n                      RETURNING\n                               blob\n                      INTO :v_blob \";\n$s = oci_parse($c,$ora_sql);\n$blob = oci_new_descriptor($c,OCI_DTYPE_LOB);\noci_bind_by_name($s,\":v_blob\", $blob,-1,OCI_B_BLOB);\noci_execute($s, OCI_DEFAULT);\nvar_dump($blob->save(\"blob test 1\"));\noci_execute($s, OCI_DEFAULT);\nvar_dump($blob->save(\"blob test 2\"));\noci_execute($s, OCI_DEFAULT);\nvar_dump($blob->save(\"blob test 3\"));\n$s = oci_parse($c, \"select blob from \".$schema.$table_name);\nvar_dump(oci_execute($s));\noci_fetch_all($s, $res);\nvar_dump($res);\necho \"Test 2b\\n\";\n$s = oci_parse($c, \"select blob from \".$schema.$table_name);\nvar_dump(oci_execute($s, OCI_DEFAULT));\nwhile ($row = oci_fetch_array($s, OCI_ASSOC)) {\n    var_dump($row);\n    $result = $row['BLOB']->load();\n    var_dump($result);\n}\nrequire __DIR__.'/drop_table.inc';\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
