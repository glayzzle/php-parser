// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/pdo_oci/tests/pdo_oci_stream_1.phpt
  it("PDO_OCI: stream_get_contents length & offset test", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__ . '/../../pdo/tests/pdo_test.inc');\n$dbh = PDOTest::factory();\n$dbh->setAttribute(PDO::ATTR_STRINGIFY_FETCHES, false);\n// Initialization\n@$dbh->exec(\"drop table pdo_oci_stream_1_tab\");\n$stmtarray = array(\n    \"create table pdo_oci_stream_1_tab (id number, data clob)\",\n);\nforeach ($stmtarray as $stmt) {\n    $dbh->exec($stmt);\n}\n$dbh->exec(\"\n  declare\n    lob1 clob := 'abc' || lpad('j',30000,'j') || 'xyz';\n   begin\n    insert into pdo_oci_stream_1_tab (id,data) values (1, 'abcdefghijklmnopqrstuvwxyz');\n    insert into pdo_oci_stream_1_tab (id,data) values (2, lob1);\n  end;\");\necho \"Test 1\\n\";\n$s = $dbh->prepare(\"select data from pdo_oci_stream_1_tab where id = 1\");\n$s->execute();\n$r = $s->fetch();\n// stream_get_contents ( resource $handle [, int $maxlength = -1 [, int $offset = -1 ]] )\necho 'Read '.stream_get_contents($r['data'], 1, 1).\"$\\n\";  // b\necho 'Read '.stream_get_contents($r['data'], 2, 1).\"$\\n\";  // cd\necho 'Read '.stream_get_contents($r['data'], 2, 0).\"$\\n\";  // ab\necho 'Read '.stream_get_contents($r['data'], 26, 0).\"$\\n\"; // abcdefghijklmnopqrstuvwxyz\necho 'Read '.stream_get_contents($r['data'], 27, 0).\"$\\n\"; // abcdefghijklmnopqrstuvwxyz\necho 'Read '.stream_get_contents($r['data'], 27, 1).\"$\\n\"; // bcdefghijklmnopqrstuvwxyz\necho 'Read '.stream_get_contents($r['data'], 1, 20).\"$\\n\"; // u\necho 'Read '.stream_get_contents($r['data'], 1, 25).\"$\\n\"; // z\necho 'Read '.stream_get_contents($r['data'], 1, 26).\"$\\n\"; // <blank>\necho 'Read '.stream_get_contents($r['data'], 1, 0).\"$\\n\";  // a\necho \"\\nTest 2\\n\";\n$s = $dbh->prepare(\"select data from pdo_oci_stream_1_tab where id = 2\");\n$s->execute();\n$r = $s->fetch();\necho 'Read '.stream_get_contents($r['data'], 5, 0).\"\\n\";           // abcjj\necho 'Read '.stream_get_contents($r['data'], 5, 2).\"\\n\";           // cjjjj\necho 'Read '.stream_get_contents($r['data'], 6, 1).\"\\n\";           // bcjjjj\necho 'Read '.strlen(stream_get_contents($r['data'], -1,0)).\"\\n\";   // 30006\necho 'Read '.strlen(stream_get_contents($r['data'], 0,0)).\"\\n\";    // 0\necho 'Read '.strlen(stream_get_contents($r['data'], 0,1)).\"\\n\";    // 0\necho 'Read '.strlen(stream_get_contents($r['data'], 10,100)).\"\\n\"; // 10\necho 'Read '.stream_get_contents($r['data'], 6, 30000).\"\\n\";       // jjjxyz\necho 'Read '.stream_get_contents($r['data'], 7, 30000).\"\\n\";       // jjjxyz\necho 'Read '.strlen(stream_get_contents($r['data'])).\"\\n\";         // 0\necho 'Read '.strlen(stream_get_contents($r['data'], 0)).\"\\n\";      // 0\necho 'Read '.strlen(stream_get_contents($r['data'], -1)).\"\\n\";     // 0\necho 'Read '.stream_get_contents($r['data'], -1, 30000).\"\\n\";      // jjjxyz\n// Clean up\n$stmtarray = array(\n    \"drop table pdo_oci_stream_1_tab\"\n);\nforeach ($stmtarray as $stmt) {\n    $dbh->exec($stmt);\n}\n?>")).toMatchSnapshot();
  });
});
