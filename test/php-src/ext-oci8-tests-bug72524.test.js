// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bug72524.phpt
  it("Bug #72524 (Binding null values triggers ORA-24816 error)", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.'/connect.inc');\n// Initialize\n$stmtarray = array(\n         \"CREATE TABLE mytable (clob_col CLOB DEFAULT NULL, varchar2_col VARCHAR2(255) DEFAULT NULL)\"\n);\noci8_test_sql_execute($c, $stmtarray);\n// Run test\n$sql = \"INSERT INTO mytable VALUES (:clob_col, :varchar2_col)\";\necho \"Test 1 - P1 Value: NULL  P1 Length: Default  P1 Type: Default  P2 Value: NULL P2 Length: Default  P2 Type: Default\\n\";\n$stmt = oci_parse($c, $sql);\n$clob = NULL;\n$varchar2 = NULL;\noci_bind_by_name($stmt, ':clob_col', $clob);\noci_bind_by_name($stmt, ':varchar2_col', $varchar2);\nvar_dump(oci_execute($stmt));\necho \"Test 2 - P1 Value: ''    P1 Length: Default  P1 Type: Default  P2 Value: ''   P2 Length: Default  P2 Type: Default\\n\";\n$clob = '';\n$varchar2 = '';\noci_bind_by_name($stmt, ':clob_col', $clob);\noci_bind_by_name($stmt, ':varchar2_col', $varchar2);\nvar_dump(oci_execute($stmt));\necho \"Test 3 - P1 Value: 'abc' P1 Length: 0        P1 Type: Default  P2 Value: ''   P2 Length: 0        P2 Type: Default\\n\";\n$clob = 'abc';\n$varchar2 = 'abc';\noci_bind_by_name($stmt, ':clob_col', $clob, 0);\noci_bind_by_name($stmt, ':varchar2_col', $varchar2, 0);\nvar_dump(oci_execute($stmt));\necho \"Test 4 - P1 Value: NULL  P1 Length: -1       P1 Type: SQLT_LNG P2 Value: NULL P2 Length: -1       P2 Type:Default\\n\";\n$clob = NULL;\n$varchar2 = NULL;\noci_bind_by_name($stmt, ':clob_col', $clob, -1, SQLT_LNG);\noci_bind_by_name($stmt, ':varchar2_col', $varchar2, -1, SQLT_LNG);\nvar_dump(oci_execute($stmt));\necho \"Test 5 - P1 Value: NULL  P1 Length: 0        P1 Type: SQLT_LNG P2 Value: NULL P2 Length: 0        P2 Type:Default\\n\";\n$clob = NULL;\n$varchar2 = NULL;\noci_bind_by_name($stmt, ':clob_col', $clob, 0, SQLT_LNG);\noci_bind_by_name($stmt, ':varchar2_col', $varchar2, 0, SQLT_LNG);\nvar_dump(oci_execute($stmt));\n// Cleanup\n$stmtarray = array(\n    \"DROP TABLE mytable\"\n);\noci8_test_sql_execute($c, $stmtarray);\n?>")).toMatchSnapshot();
  });
});
