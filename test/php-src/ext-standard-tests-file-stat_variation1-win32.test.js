// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/file/stat_variation1-win32.phpt
  it("Test stat() functions: usage variations - effects of rename()", function () {
    expect(parser.parseCode("<?php\n/* test the effects of rename() on stats of dir/file */\n$file_path = __DIR__;\nrequire \"$file_path/file.inc\";\n/* create temp file and directory */\nmkdir(\"$file_path/stat_variation1/\");  // temp dir\n$file_handle = fopen(\"$file_path/stat_variation1.tmp\", \"w\");  // temp file\nfclose($file_handle);\necho \"*** Testing stat(): on file and directory ater renaming them ***\\n\";\n// renaming a file\necho \"-- Testing stat() for files after being renamed --\\n\";\n$old_filename = \"$file_path/stat_variation1.tmp\";\n$new_filename = \"$file_path/stat_variation1a.tmp\";\n$old_stat = stat($old_filename);\nclearstatcache();\nsleep(1);\nvar_dump( rename($old_filename, $new_filename) );\n$new_stat = stat($new_filename);\n// compare the self stat\nvar_dump( compare_self_stat($old_stat) );\nvar_dump( compare_self_stat($new_stat) );\n// compare the two stats\nvar_dump( compare_stats($old_stat, $old_stat, $all_stat_keys) );\n// clear the cache\nclearstatcache();\n// renaming a directory\necho \"-- Testing stat() for directory after being renamed --\\n\";\n$old_dirname = \"$file_path/stat_variation1\";\n$new_dirname = \"$file_path/stat_variation1a\";\n$old_stat = stat($old_dirname);\nclearstatcache();\nsleep(2);\nvar_dump( rename($old_dirname, $new_dirname) );\n$new_stat = stat($new_dirname);\n// compare self stats\nvar_dump( compare_self_stat($old_stat) );\nvar_dump( compare_self_stat($new_stat) );\n// compare the two stats\nvar_dump( compare_stats($old_stat, $new_stat, $all_stat_keys) );\n// clear the cache\nclearstatcache();\necho \"\\n*** Done ***\";\n?>")).toMatchSnapshot();
  });
});
