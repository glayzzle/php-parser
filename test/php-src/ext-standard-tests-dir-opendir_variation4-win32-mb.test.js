// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/dir/opendir_variation4-win32-mb.phpt
  it("Test opendir() function : usage variations - different relative paths", function () {
    expect(parser.parseCode("<?php\n/*\n * Test opendir() with different relative paths as $path argument\n */\necho \"*** Testing opendir() : usage variation ***\\n\";\n$base_dir_path = __DIR__ . '/opendir_variation4-win32-mb';\n@mkdir($base_dir_path);\n$level_one_dir_name = \"私はガラスを食べられますlevel_one\";\n$level_one_dir_path = \"$base_dir_path/$level_one_dir_name\";\n$level_two_dir_name = \"私はガラスを食べられますlevel_two\";\n$level_two_dir_path = \"$base_dir_path/$level_one_dir_name/$level_two_dir_name\";\n// create directories\nmkdir($level_one_dir_path);\nmkdir($level_two_dir_path);\necho \"\\n-- \\$path = './私はガラスを食べられますlevel_one': --\\n\";\nvar_dump(chdir($base_dir_path));\nvar_dump($dh = opendir(\"./$level_one_dir_name\"));\nclean_dh($dh);\necho \"\\n-- \\$path = '私はガラスを食べられますlevel_one/私はガラスを食べられますlevel_two': --\\n\";\nvar_dump(chdir($base_dir_path));\nvar_dump($dh = opendir(\"$level_one_dir_name/$level_two_dir_name\"));\nclean_dh($dh);\necho \"\\n-- \\$path = '..': --\\n\";\nvar_dump($dh = opendir('..'));\nclean_dh($dh);\necho \"\\n-- \\$path = 'level_two', '.': --\\n\";\nvar_dump(chdir($level_two_dir_path));\nvar_dump($dh = opendir('.'));\nclean_dh($dh);\necho \"\\n-- \\$path = '../': --\\n\";\nvar_dump($dh = opendir('../'));\nclean_dh($dh);\necho \"\\n-- \\$path = './': --\\n\";\nvar_dump(chdir($level_two_dir_path));\nvar_dump($dh = opendir('./'));\nclean_dh($dh);\necho \"\\n-- \\$path = '../../'私はガラスを食べられますlevel_one': --\\n\";\nvar_dump(chdir($level_two_dir_path));\nvar_dump($dh = opendir(\"../../$level_one_dir_name\"));\nclean_dh($dh);\n/*\n * function to remove directory handle before re-using variable name in test\n * and to ensure directory is not in use at CLEAN section so can me removed\n */\nfunction clean_dh($dh){\n    if (is_resource($dh)) {\n        closedir($dh);\n    }\n    unset($dh);\n}\n?>")).toMatchSnapshot();
  });
});
