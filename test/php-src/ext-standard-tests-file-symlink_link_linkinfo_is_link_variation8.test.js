// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/file/symlink_link_linkinfo_is_link_variation8.phpt
  it("Test symlink(), linkinfo(), link() and is_link() functions : usage variations - try link with same name in diff. dir", function () {
    expect(parser.parseCode("<?php\n/* Variation 8 : Create soft/hard link to different directory */\n/* creating link to a file in different dir with the same name as the file */\necho \"\\n*** Create hard link in different directory with same filename ***\\n\";\n// temp file used\n$file_path = __DIR__;\n$filename = \"$file_path/symlink_link_linkinfo_is_link_variation8.tmp\";\n// temp link name used\n$dirname = \"$file_path/symlink_link_linkinfo_is_link1_variation8\";\nmkdir($dirname);\n$linkname = \"symlink_link_linkinfo_is_link_variation8.tmp\";\n// create temp file\n$fp = fopen($filename, \"w\");\nfclose($fp);\nvar_dump( link($filename, $dirname.\"/\") ); // this fails indicating file exists\n// ok, creates \"$file_path/symlink_link_linkinfo_is_link1_variation8/symlink_link_linkinfo_is_link_variation8.tmp\" link\nvar_dump( link($filename, $dirname.\"/\".$linkname) );  // this works fine\n// delete link\nunlink($dirname.\"/\".$linkname);\n// delete temp file\nunlink($filename);\n// delete temp dir\nrmdir($dirname);\necho \"\\n*** Create soft link in different directory with same filename ***\\n\";\n$filename = \"$file_path/symlink_link_linkinfo_is_link_variation8.tmp\";\n// temp link name used\n$dirname = \"$file_path/symlink_link_linkinfo_is_link1_variation8\";\nmkdir($dirname);\n$linkname = \"symlink_link_linkinfo_is_link_variation8.tmp\";\n// create temp file\n$fp = fopen($filename, \"w\");\nfclose($fp);\nvar_dump( symlink($filename, $dirname.\"/\") ); // this fails indicating file exists\n// ok, creates \"$file_path/symlink_link_linkinfo_is_link1_variation8/symlink_link_linkinfo_is_link_variation8.tmp\" link\nvar_dump( symlink($filename, $dirname.\"/\".$linkname) );  // this works fine\n// delete link\nunlink($dirname.\"/\".$linkname);\n// delete temp file\nunlink($filename);\n// delete temp dir\nrmdir($dirname);\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
