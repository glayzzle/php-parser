// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/lob_031.phpt
  it("Test LOB->read(), LOB->seek() and LOB->tell() with nul bytes in data", function () {
    expect(parser.parseCode("<?php\nrequire __DIR__.'/connect.inc';\nrequire __DIR__.'/create_table.inc';\n$ora_sql = \"INSERT INTO\n                       \".$schema.$table_name.\" (blob)\n                      VALUES (empty_blob())\n                      RETURNING\n                               blob\n                      INTO :v_blob \";\n$statement = oci_parse($c,$ora_sql);\n$blob = oci_new_descriptor($c,OCI_D_LOB);\noci_bind_by_name($statement,\":v_blob\", $blob,-1,OCI_B_BLOB);\noci_execute($statement, OCI_DEFAULT);\n$blob->write(\"test\");\n$blob->tell();\n$blob->seek(10, OCI_SEEK_CUR);\n$blob->write(\"string\");\n$blob->flush();\n$select_sql = \"SELECT blob FROM \".$schema.$table_name;\n$s = oci_parse($c, $select_sql);\noci_execute($s);\n$row = oci_fetch_array($s);\n$row[0]->read(3);\necho \" 1. \".$row[0]->tell(). \"\\n\";\n$row[0]->read(3);\necho \" 2. \".$row[0]->tell(). \"\\n\";\n$row[0]->read(3);\necho \" 3. \".$row[0]->tell(). \"\\n\";\n$row[0]->read(6);\necho \" 4. \".$row[0]->tell(). \"\\n\";\n$row[0]->read(4);\necho \" 5. \".$row[0]->tell(). \"\\n\";\n// Read past end\n$row[0]->read(5);\necho \" 6. \".$row[0]->tell(). \"\\n\";\n$row[0]->read(1);\necho \" 8. \".$row[0]->tell(). \"\\n\";\n// Now seek\n$row[0]->seek(1);\necho \" 9. \".$row[0]->tell(). \"\\n\";\n$row[0]->seek(8);\necho \"10. \".$row[0]->tell(). \"\\n\";\n$row[0]->seek(20);\necho \"11. \".$row[0]->tell(). \"\\n\";\n// Seek past end\n$row[0]->seek(25);\necho \"12. \".$row[0]->tell(). \"\\n\";\n// Seek past end\n$row[0]->seek(2, OCI_SEEK_SET);\necho \"13. \".$row[0]->tell(). \"\\n\";\n// Move on 2 more\n$row[0]->seek(2, OCI_SEEK_CUR);\necho \"14. \".$row[0]->tell(). \"\\n\";\n// Move 3 past the end\n$row[0]->seek(3, OCI_SEEK_END);\necho \"15. \".$row[0]->tell(). \"\\n\";\n// Move 4 before the end\n$row[0]->seek(-4, OCI_SEEK_END);\necho \"16. \".$row[0]->tell(). \"\\n\";\nrequire __DIR__.'/drop_table.inc';\necho \"Done\\n\";\n?>")).toMatchSnapshot();
  });
});
