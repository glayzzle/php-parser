// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bind_misccoltypes_errs.phpt
  it("Bind miscellaneous column types and generating errors", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.'/connect.inc');\n// Initialization\n$stmtarray = array(\n    \"drop table bind_misccoltypes_errs_tab\",\n    \"create table bind_misccoltypes_errs_tab (\n        id                number,\n        char_t            char(1),\n        char_t10          char(10),\n        varchar2_t10      varchar2(10),\n        number_t          number,\n        number_t92        number(9,2),\n        number_t6         number(6),\n        date_t            date,\n        timestamp_t       timestamp,\n        float_t           float,\n        binary_float_t    binary_float,\n        binary_double_t   binary_double,\n        decimal_t         decimal,\n        integer_t         integer,\n        nchar_t           nchar(10),\n        nvarchar2_t10     nvarchar2(10),\n        varchar_t10       varchar(10) )\",\n);\noci8_test_sql_execute($c, $stmtarray);\nfunction check_col($c, $colname, $id)\n{\n    $s = oci_parse($c, \"select $colname from bind_misccoltypes_errs_tab where id = :id\");\n    oci_bind_by_name($s, \":id\", $id);\n    oci_execute($s);\n    oci_fetch_all($s, $r);\n    var_dump($r);\n}\n// Tests\necho \"\\nTest 1 insert numbers\\n\";\n$n1 = -23253245.3432467;\n$s = oci_parse($c, \"INSERT INTO bind_misccoltypes_errs_tab (id, number_t6) VALUES (1, :n1)\");\noci_bind_by_name($s, \":n1\", $n1);\noci_execute($s);\ncheck_col($c, 'number_t6', 57);\necho \"\\nTest 2 insert numbers\\n\";\n$n1 = \"Hello\";\n$s = oci_parse($c, \"INSERT INTO bind_misccoltypes_errs_tab (id, number_t6) VALUES (2, :n1)\");\noci_bind_by_name($s, \":n1\", $n1);\noci_execute($s);\ncheck_col($c, 'number_t6', 57);\necho \"\\nTest 3 - too long CHAR\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_misccoltypes_errs_tab (id, char_t) VALUES (3, :c2)\");\n$c2 = \"AB\";\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_AFC);\noci_execute($s);\necho \"\\nTest 4 - too long VARCHAR2\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_misccoltypes_errs_tab (id, varchar2_t10) VALUES (4, :c2)\");\n$c2 = \"AAAAAAAAAAB\";\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_AFC);\noci_execute($s);\necho \"\\nTest 5 - invalid number\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_misccoltypes_errs_tab (id, number_t) VALUES (5, :c2)\");\n$c2 = \"ABC\";\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_AFC);\noci_execute($s);\necho \"\\nTest 6 - insert a VARCHAR2 with SQLT_BIN\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_misccoltypes_errs_tab (id, varchar2_t10) VALUES (6, :c2)\");\n$c2 = \"Hood 6\";\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_BIN);\noci_execute($s);\ncheck_col($c, 'varchar2_t10', 6);\necho \"\\nTest 7 - insert a VARCHAR2 with SQLT_LBI\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_misccoltypes_errs_tab (id, varchar2_t10) VALUES (7, :c2)\");\n$c2 = \"Hood 7\";\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_LBI);\noci_execute($s);\ncheck_col($c, 'varchar2_t10', 7);\n// Clean up\n$stmtarray = array(\n    \"drop table bind_misccoltypes_errs_tab\"\n);\noci8_test_sql_execute($c, $stmtarray);\noci_close($c);\n?>")).toMatchSnapshot();
  });
});
