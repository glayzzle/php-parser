// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/oci8/tests/bind_sqltnum_11g.phpt
  it("Bind with SQLT_NUM", function () {
    expect(parser.parseCode("<?php\nrequire(__DIR__.'/connect.inc');\n// Initialization\n$stmtarray = array(\n    \"drop table bind_sqltnum_tab\",\n    \"create table bind_sqltnum_tab (\n        id                number,\n        varchar2_t10      varchar2(10),\n        number_t          number,\n        number_t92        number(9,2))\"\n);\noci8_test_sql_execute($c, $stmtarray);\nfunction check_col($c, $colname, $id)\n{\n    $s = oci_parse($c, \"select $colname from bind_sqltnum_tab where id = :id\");\n    oci_bind_by_name($s, \":id\", $id);\n    oci_execute($s);\n    oci_fetch_all($s, $r);\n    var_dump($r);\n}\n// Run Test\necho \"Test 1 - baseline test\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, varchar2_t10) VALUES (100, :c2)\");\n$c2 = \"Hood\";\n$r = oci_bind_by_name($s, \":c2\", $c2, -1);\nif (!$r) {\n    $e = oci_error($s);\n    var_dump($e);\n}\n$r = oci_execute($s, OCI_DEFAULT);\nif (!$r) {\n    $e = oci_error($s);\n    var_dump($e);\n}\n$s = oci_parse($c, \"select id, varchar2_t10 from bind_sqltnum_tab\");\noci_execute($s);\noci_fetch_all($s, $data);\nvar_dump($data);\necho \"Test 2 - SQLT_NUM to a VARCHAR2 column\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, varchar2_t10) VALUES (100, :c2)\");\n$c2 = \"Hood\";\n$r = oci_bind_by_name($s, \":c2\", $c2, -1, SQLT_NUM);\nif (!$r) {\n    $e = oci_error($s);\n    var_dump($e['message']);\n}\n$r = oci_execute($s, OCI_DEFAULT);\nif (!$r) {\n    $e = oci_error($s);\n    var_dump($e['message']);\n}\necho \"\\nTEST41 wrong bind type SQLT_NUM\\n\";\n$c2 = \"Hood41\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, varchar2_t10) VALUES (41, :c2)\");\noci_bind_by_name($s, \":c2\", $c2, -1, SQLT_NUM);\noci_execute($s);\necho \"\\nTEST42 insert numbers SQLT_NUM\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t) VALUES (42, :n1)\");\n$n1 = 42;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t', 42);\necho \"\\nTEST43 insert numbers SQLT_NUM\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t) VALUES (43, :n1)\");\n$n1 = 42.69;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t', 43);\necho \"\\nTEST44\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t) VALUES (44, :n1)\");\n$n1 = 0;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t', 44);\necho \"\\nTEST45\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t) VALUES (45, :n1)\");\n$n1 = -23;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t', 45);\necho \"\\nTEST46 insert numbers\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t) VALUES (46, :n1)\");\n$n1 = \"-23\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t', 46);\necho \"\\nTEST47\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t) VALUES (47, :n1)\");\n$n1 = \"23\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t', 47);\necho \"\\nTEST48\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t92) VALUES (48, :n1)\");\n$n1 = 123.56;\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t92', 48);\necho \"\\nTEST49\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t92) VALUES (49, :n1)\");\n$n1 = \"123.56\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t92', 49);\necho \"\\nTEST50\\n\";\n$s = oci_parse($c, \"INSERT INTO bind_sqltnum_tab (id, number_t92) VALUES (50, :n1)\");\n$n1 = \"\";\noci_bind_by_name($s, \":n1\", $n1, -1, SQLT_NUM);\noci_execute($s);\ncheck_col($c, 'number_t92', 50);\n// Clean up\n$stmtarray = array(\n    \"drop table bind_sqltnum_tab\"\n);\noci8_test_sql_execute($c, $stmtarray);\n?>")).toMatchSnapshot();
  });
});
