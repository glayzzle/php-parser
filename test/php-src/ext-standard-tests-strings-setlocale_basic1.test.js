// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/standard/tests/strings/setlocale_basic1.phpt
  it("Test setlocale() function : basic functionality - setting system locale to a specific", function () {
    expect(parser.parseCode("<?php\n/* test setlocale by specifying a specific locale as input */\nfunction list_system_locales() {\n  // start the buffering of next command to internal output buffer\n  ob_start();\n  // run the command 'locale -a' to fetch all locales available in the system\n  system('locale -a');\n  // get the contents from the internal output buffer\n  $all_locales = ob_get_contents();\n  // fflush and end the output buffering to internal output buffer\n  ob_end_clean();\n  $system_locales = explode(\"\\n\", $all_locales);\n  // return all the locale found in the system\n  return $system_locales;\n}\n/* Collect existing system locales and set one among them,\n   Check the currency settings in the new locale  */\necho \"*** Testing setlocale() : basic functionality - set to a specific locale ***\\n\";\n//set of locales to be used\n$common_locales = array(\n  \"english_US\"=> \"en_US.utf8\",\n  \"english_AU\" => \"en_AU.utf8\",\n  \"korean_KR\" => \"ko_KR.utf8\",\n  \"Chinese_zh\" => \"zh_CN.utf8\",\n  \"germen_DE\" => \"de_DE.utf8\",\n  \"spanish_es\" => \"es_EC.utf8\",\n  \"french_FR\" => \"fr_FR.utf8\",\n  \"japanees_JP\" => \"ja_JP.utf8\",\n  \"greek_GR\" => \"el_GR.utf8\",\n  \"dutch_NL\" => \"nl_NL.utf8\"\n);\n//set of currency symbol according to above list of locales\n$currency_symbol = array(\n  \"en_US.utf8\" => \"USD\",\n  \"en_AU.utf8\" => \"AUD\",\n  \"ko_KR.utf8\" => \"KRW\",\n  \"zh_CN.utf8\" => \"CNY\",\n  \"de_DE.utf8\" => \"EUR\",\n  \"es_EC.utf8\" => \"USD\",\n  \"fr_FR.utf8\" => \"EUR\",\n  \"ja_JP.utf8\" => \"JPY\",\n  \"el_GR.utf8\" => \"EUR\",\n  \"nl_NL.utf8\" =>\"EUR\"\n);\n// gather all the locales installed in the system\n$all_system_locales = list_system_locales();\n// set the system locale to a locale, choose the right locale by\n// finding a common locale in commonly used locale stored in\n// $common_locales & locales that are available in the system, stored\n// in $all_system_locales.\necho \"Setting system locale(LC_ALL) to \";\nforeach($common_locales as $value) {\n  // check if a commonly used locale is installed in the system\n  if(in_array($value, $all_system_locales)){\n    echo \"$value\\n\"; // print, this is found\n    // set the found locale as current locale\n    var_dump(setlocale(LC_ALL, $value ));\n    // stop here\n    break;\n  }\n  else{\n    // continue to check if next commonly locale is installed in the system\n    continue;\n  }\n}\n// check that new locale setting is effective\n// use localeconv() to get the details of currently set locale\n$locale_info = localeconv();\n//checking currency settings in the new locale to see if the setlocale() was effective\n$new_currency = trim($locale_info['int_curr_symbol']);\necho \"Checking currency settings in the new locale, expected: \".$currency_symbol[$value].\", Found: \".$new_currency.\"\\n\";\necho \"Test \";\nif(trim($currency_symbol[$value]) == $new_currency){\n  echo \"PASSED.\";\n} else {\n  echo \"FAILED.\";\n}\necho \"\\nDone\\n\";\n?>")).toMatchSnapshot();
  });
});
