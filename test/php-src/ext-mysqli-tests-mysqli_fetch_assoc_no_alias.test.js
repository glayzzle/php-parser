// eslint-disable prettier/prettier
const parser = require("../main");

describe("php-src tests", function () {
  // ext/mysqli/tests/mysqli_fetch_assoc_no_alias.phpt
  it("mysqli_fetch_assoc()", function () {
    expect(parser.parseCode("<?php\n    require('table.inc');\n    if (!$res = mysqli_query($link, \"SELECT 1, 2\")) {\n        printf(\"[001] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[002]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    if (!$res = mysqli_query($link, \"SELECT 1 AS a, 2\")) {\n        printf(\"[003] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[004]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    if (!$res = mysqli_query($link, \"SELECT 1 AS a, 2, 2 as '2'\")) {\n        printf(\"[005] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[006]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    if (!$res = mysqli_query($link, \"SELECT 1 AS a, 2 as '2', 2\")) {\n        printf(\"[007] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[008]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    /* Now do it with unbuffered queries */\n    if (!$res = mysqli_real_query($link, \"SELECT 1, 2\")) {\n        printf(\"[009] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_use_result($link)) {\n        printf(\"[010] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[011]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    if (!$res = mysqli_real_query($link, \"SELECT 1 AS a, 2\")) {\n        printf(\"[012] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_use_result($link)) {\n        printf(\"[013] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[014]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    if (!$res = mysqli_real_query($link, \"SELECT 1 AS a, 2, 2 as '2'\")) {\n        printf(\"[015] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_use_result($link)) {\n        printf(\"[016] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[017]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    if (!$res = mysqli_real_query($link, \"SELECT 1 AS a, 2 as '2', 2\")) {\n        printf(\"[015] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    if (!$res = mysqli_use_result($link)) {\n        printf(\"[016] [%d] %s\\n\", mysqli_errno($link), mysqli_error($link));\n    }\n    print \"[017]\\n\";\n    var_dump(mysqli_fetch_assoc($res));\n    mysqli_free_result($res);\n    mysqli_close($link);\n    print \"done!\";\n?>")).toMatchSnapshot();
  });
});
